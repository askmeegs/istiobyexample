<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><meta name="generator" content="Hugo 0.68.3" /><link href="https://fonts.googleapis.com/css?family=Chivo|Fira+Code|Noto+Sans&display=swap" rel="stylesheet">
<link rel="shortcut icon" href="../images/spider-web.png">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light only">
<meta name="supported-color-schemes" content="light only"><title>Modify Response Headers&nbsp;&ndash;&nbsp;Istio By Example</title><link rel="stylesheet" href="../css/core.min.5b1354256619a0627d4615002413039a7ac100c07d758b39ba5801b2c8ee1a26ce30da633f02c8de2ee256e8cc539473.css" integrity="sha384-WxNUJWYZoGJ9RhUAJBMDmnrBAMB9dYs5ulgBssjuGibOMNpjPwLI3i7iVujMU5Rz"><meta property="og:title" content="Modify Response Headers" />
<meta property="og:description" content="With Istio, you can apply traffic rules to route based on HTTP request headers. You can also use Istio to modify response headers. This could be useful if you want to strip headers generated by your application, or if you want to add response headers without changing your application code.

In this example, we will apply an Istio VirtualService to add a new header (hello:world), then remove the set-cookie header." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/istiobyexample/response-headers/" />
<meta property="og:image" content="/istiobyexample/images/istio-framed.jpg"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/istiobyexample/images/istio-framed.jpg"/>
<meta name="twitter:title" content="Modify Response Headers"/>
<meta name="twitter:description" content="With Istio, you can apply traffic rules to route based on HTTP request headers. You can also use Istio to modify response headers. This could be useful if you want to strip headers generated by your application, or if you want to add response headers without changing your application code.

In this example, we will apply an Istio VirtualService to add a new header (hello:world), then remove the set-cookie header."/>
</head>
<body>
    <div class="base-body max-width"><section id="header" class="header max-body-width">
    <p><a class="home" href="../"><img class="site-logo" src="../images/istio-logo.png" alt />
            <span class="site-name">Istio By Example</span></a></p>
</section><div id="content" class="flex-body max-body-width"><section class="article-header">
    <h1 class="article-title">Modify Response Headers</h1>
</section>
<div class="flex-body">
<article class="markdown-body"><p>With Istio, you can apply traffic rules to route based on <a href="https://istio.io/docs/tasks/traffic-management/request-routing/#route-based-on-user-identity"target="_blank">HTTP request headers</a>. You can also use Istio to <a href="https://istio.io/docs/reference/config/networking/v1alpha3/virtual-service/#Headers"target="_blank">modify response headers</a>. This could be useful if you want to strip headers generated by your application, or if you want to add response headers without changing your application code.</p>
<p><a target="_blank" rel="noopener noreferrer" href="../images/modify-response-headers.png"><img class="img" src="../images/modify-response-headers.png"
        alt/></a></p>
<p>In this example, we will apply an Istio <a href="https://istio.io/docs/concepts/traffic-management/#virtual-services"target="_blank">VirtualService</a> to add a new header (<code>hello:world</code>), then remove the <code>set-cookie</code> header. Then, all client requests entering the service mesh through the <code>default</code> gateway will receive those modified headers.</p>
<div class="highlight"><pre class="chroma"><code class="language-YAML" data-lang="YAML"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>networking.istio.io/v1alpha3<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>VirtualService<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>frontend-ingress<span class="w">
</span><span class="w"></span><span class="k">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">hosts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="s2">&#34;*&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">gateways</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- frontend-gateway<span class="w">
</span><span class="w">  </span><span class="k">http</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="k">route</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="k">destination</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">host</span><span class="p">:</span><span class="w"> </span>frontend<span class="w">
</span><span class="w">        </span><span class="k">port</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">number</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">      </span><span class="k">headers</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">response</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="k">add</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">hello</span><span class="p">:</span><span class="w"> </span>world<span class="w">
</span><span class="w">          </span><span class="k">remove</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="s2">&#34;set-cookie&#34;</span><span class="w">
</span></code></pre></div><p>Before we apply the VirtualService, the <code>frontend</code> service returns the following response headers:</p>
<pre><code>HTTP/1.1 200 OK
set-cookie: shop_session-id=432bef95-0d25-4754-80c8-3904c2e329e9; Max-Age=172800
date: Wed, 18 Sep 2019 16:26:01 GMT
content-type: text/html; charset=utf-8
x-envoy-upstream-service-time: 45
server: istio-envoy
transfer-encoding: chunked
</code></pre><p>Then when we <code>kubectl apply</code> the VirtualService, we see that Envoy is successfully configured to modify the response headers:</p>
<pre><code>HTTP/1.1 200 OK
date: Wed, 18 Sep 2019 16:26:24 GMT
content-type: text/html; charset=utf-8
x-envoy-upstream-service-time: 85
hello: world
server: istio-envoy
transfer-encoding: chunked
</code></pre></article>
</div><section id="footer" class="footer">
    <p>Made with ❤️ by <a href="https://twitter.com/askmeegs">Megan O'Keefe</a> | <a href="https://github.com/askmeegs/istiobyexample">Source</a> | <a href="https://github.com/cntrump/hugo-notepadium">Theme</a></p>
</section></div>
    </div>
</body>
</html>