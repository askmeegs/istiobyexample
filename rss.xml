<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Istio By Example]]></title><description><![CDATA[Service Mesh Made Simple]]></description><link>https://istiobyexample.dev/</link><generator>RSS for Node</generator><lastBuildDate>Fri, 27 Dec 2019 21:46:52 GMT</lastBuildDate><item><title><![CDATA[grpc]]></title><description><![CDATA[gRPC is a communication protocol for services, built on HTTP/2. Unlike REST over HTTP/1, which is based on resources, gRPC is based on‚Ä¶]]></description><link>https://istiobyexample.dev//grpc/</link><guid isPermaLink="false">https://istiobyexample.dev//grpc/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://grpc.io/&quot;&gt;gRPC&lt;/a&gt; is a communication protocol for services, built on &lt;a href=&quot;https://www.cncf.io/blog/2018/08/31/grpc-on-http-2-engineering-a-robust-high-performance-protocol/&quot;&gt;HTTP/2&lt;/a&gt;. Unlike REST over HTTP/1, which is based on &lt;a href=&quot;https://en.wikipedia.org/wiki/Representational_state_transfer&quot;&gt;resources&lt;/a&gt;, gRPC is based on &lt;a href=&quot;https://grpc.io/docs/guides/concepts/&quot;&gt;Service Definitions&lt;/a&gt;. You specify service definitions in a format called &lt;a href=&quot;https://developers.google.com/protocol-buffers/&quot;&gt;protocol buffers&lt;/a&gt; (‚Äúproto‚Äù), which can be serialized into an small binary format for transmission.&lt;/p&gt;
&lt;p&gt;With gRPC, you can generate boilerplate code from &lt;code class=&quot;language-text&quot;&gt;.proto&lt;/code&gt; files into &lt;a href=&quot;https://grpc.io/docs/quickstart/&quot;&gt;multiple programming languages&lt;/a&gt;, making gRPC an ideal choice for polyglot microservices.&lt;/p&gt;
&lt;p&gt;While gRPC supports some networking use cases like &lt;a href=&quot;https://grpc.io/docs/guides/auth/&quot;&gt;TLS&lt;/a&gt; and &lt;a href=&quot;https://grpc.io/blog/loadbalancing/&quot;&gt;client-side load balancing&lt;/a&gt;, adding Istio to a gRPC architecture can be useful for collecting telemetry, adding traffic rules, and setting &lt;a href=&quot;https://istio.io/blog/2018/istio-authorization/#rpc-level-authorization&quot;&gt;RPC-level authorization&lt;/a&gt;. Istio can also provide a useful management layer if your traffic is a mix of HTTP, TCP, gRPC, and database protocols, because you can use the same Istio APIs for all traffic types.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://istio.io/about/feature-stages/#traffic-management&quot;&gt;Istio&lt;/a&gt; and its data plane proxy, &lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/grpc#arch-overview-grpc&quot;&gt;Envoy&lt;/a&gt;, both  support gRPC. Let‚Äôs see how to manage gRPC traffic with Istio.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/df7cd7dab819fa1db10d469a25e27819/624c6/grpc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.75231676495367%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAJnKAACZygHjkaQiAAABH0lEQVQoz31Sa0+DQBDs//9dmhhjvzUxxBr1Q4XyOrj3k3GPKlJFL5nswc5Ohll22DrT6jpNV1g1Nkd3mSSdB7cOgqoOAQYJiupa4EswpQQZPzk+fM/5C38WrITCaCxaY2CVg3p4h+AGgXo+JtgQr8yPtYQvOAZr0WuDjsAIKQtm0okLtFKj8Ra6aBFeB7BDhbOXeGEt3sYBteboDNVgUe+PEHe3qJ869PSczTDC4rAUEopsM+9gSwG3L8GPHZrUo3Fn+kSBwQ/obAfyBvZYQd/co31uMMb4WzBbbpWeoSkfxdSczV/7GjmDPFEsqiYhg4HEMn8RXCNS6Dmx9OP9AupFW8LLA4IokGLO7sKft/zfb5PHtzY9nyBI2VwN5N4HZfNwqHP3/dwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;grpc&quot;
        title=&quot;grpc&quot;
        src=&quot;/static/df7cd7dab819fa1db10d469a25e27819/b9e4f/grpc.png&quot;
        srcset=&quot;/static/df7cd7dab819fa1db10d469a25e27819/cf440/grpc.png 148w,
/static/df7cd7dab819fa1db10d469a25e27819/d2d38/grpc.png 295w,
/static/df7cd7dab819fa1db10d469a25e27819/b9e4f/grpc.png 590w,
/static/df7cd7dab819fa1db10d469a25e27819/f9b6a/grpc.png 885w,
/static/df7cd7dab819fa1db10d469a25e27819/2d849/grpc.png 1180w,
/static/df7cd7dab819fa1db10d469a25e27819/624c6/grpc.png 5935w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Here, we‚Äôre running two gRPC Services, &lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;. &lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt; makes an RPC call to the &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;‚Äôs &lt;code class=&quot;language-text&quot;&gt;/SayHello&lt;/code&gt; function every 2 seconds.&lt;/p&gt;
&lt;p&gt;Adding Istio to gRPC Kubernetes services has one pre-requisite: &lt;a href=&quot;https://istio.io/docs/setup/kubernetes/additional-setup/requirements/&quot;&gt;labeling&lt;/a&gt; your Kubernetes Service ports. The server‚Äôs port is labeled as follows:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; server
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; server
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; grpc &lt;span class=&quot;token comment&quot;&gt;# important!&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; TCP
    &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Once we deploy the app, we can see this traffic between client and server in a &lt;a href=&quot;https://www.kiali.io/&quot;&gt;service graph&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2cc7e6ef92a4f359ae247e47ece8e510/54f11/kiali.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 35.11543134872418%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABFUlEQVQoz32RS2+DMBCE+f+nXqqqL+XQQxslf6QNVCqoh1g9VEEQASbhERvbGKbGbRVEUUda+bCrb2bXTt/3+K1B43faY4whDEMkSYLdbocoipCmKfI8R9u26LoODkaag4zFOQchBBnN4Ac+yAdBURb2jeMYSik4UkpQSiEa8QfAaoayLO3goCHBjM8okElY17V129M9Gt3gcDygqI5g6oTN+wu2ZAsp5Dml4lh4N7h1r3Bn6t69xuXzBV4j1/btylprCAPjiqGqK1Sn0sA5KMvsbWw6425TS4a1v8Tq7RGr4AnrYIkHbwHvc/MN7P/bYea2+BkX5gxtRAF1nhtMnelHzNUUqjuzUSsgOINqJXSvLWzofQE1AxnLSAsiIQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;kiali&quot;
        title=&quot;kiali&quot;
        src=&quot;/static/2cc7e6ef92a4f359ae247e47ece8e510/b9e4f/kiali.png&quot;
        srcset=&quot;/static/2cc7e6ef92a4f359ae247e47ece8e510/cf440/kiali.png 148w,
/static/2cc7e6ef92a4f359ae247e47ece8e510/d2d38/kiali.png 295w,
/static/2cc7e6ef92a4f359ae247e47ece8e510/b9e4f/kiali.png 590w,
/static/2cc7e6ef92a4f359ae247e47ece8e510/f9b6a/kiali.png 885w,
/static/2cc7e6ef92a4f359ae247e47ece8e510/2d849/kiali.png 1180w,
/static/2cc7e6ef92a4f359ae247e47ece8e510/54f11/kiali.png 1646w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;We can also view the server‚Äôs gRPC traffic metrics in Grafana:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5d71c16e00c4e645b843e7b15602d1d3/362b5/server-healthy.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.42690058479532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABa0lEQVQozz2Q61KDMBCFeYje24RAyAVCqUArl9ZedKqOOuMP3/9Zjktq/bHs7GbP4dsNxpMZhhj95cl0jtF4itl8CWNTyERBGwulDZS6xfB2n/Vamr/7BMNnNltgsVjR4IKaN7MV44iiCIIiDAWWyxU49QQXmNP7aHwz9Nol85qhDphQMK7Cumyg0gJMaEip4DKH1GY+4kiSscRDvUXdtCjKisg1GBNIiDhfb4jc+jrgpkLef6C7/qDo3xFmDXiyhnQN+ssndNGByZxEa5xejzheD2iPDYzJiDymn2tU1Q6JNL4OWKQRmwIqKyHtxhNGykG5GklaUr/2tRAxbJbD5QXdNKUTMU8khPR0Q16xkAjjFHl9wG7/Ald24NL5dXIS1vWO8sZTDCbdcY/D8wmPfQNLp+A8+if0K/NhZV3CtW9onr+RN1dwu0OoyaTYo718QT88gSUb2DRDf+7QnVts2xoxGd0Ny3Lr81D/AmmByrGFj507AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;server healthy&quot;
        title=&quot;server healthy&quot;
        src=&quot;/static/5d71c16e00c4e645b843e7b15602d1d3/b9e4f/server-healthy.png&quot;
        srcset=&quot;/static/5d71c16e00c4e645b843e7b15602d1d3/cf440/server-healthy.png 148w,
/static/5d71c16e00c4e645b843e7b15602d1d3/d2d38/server-healthy.png 295w,
/static/5d71c16e00c4e645b843e7b15602d1d3/b9e4f/server-healthy.png 590w,
/static/5d71c16e00c4e645b843e7b15602d1d3/f9b6a/server-healthy.png 885w,
/static/5d71c16e00c4e645b843e7b15602d1d3/2d849/server-healthy.png 1180w,
/static/5d71c16e00c4e645b843e7b15602d1d3/362b5/server-healthy.png 2394w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Then, we can apply an Istio traffic rule to inject a 10-second delay &lt;a href=&quot;https://istio.io/docs/tasks/traffic-management/fault-injection/&quot;&gt;fault&lt;/a&gt; into &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;. You might apply this rule in a chaos testing scenario, to test the resiliency of this application.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; server&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;fault
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; server
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;fault&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;percentage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100.0&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;fixedDelay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 10s
    &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; server
        &lt;span class=&quot;token key atrule&quot;&gt;subset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This causes the client RPC to time out (&lt;code class=&quot;language-text&quot;&gt;Outgoing Request Duration&lt;/code&gt;):&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/30cf39c76b02540fad215f5f0eb110cc/f94bd/grafana-client-fault-inject.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.168067226890756%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxElEQVQoz2VS23LaMBD1RwQIxBdsS7ZsyZZlGGwgJOlM2obJ5P8/53R3S3hoH85ovdKey0K0WD5isSLQ+bBY4WG5utd8lkqjaS1M00r93f8Xy9VaeKLvxuP6CZtNgvUmvoN7cRwjTTMkcYKnW0/u1zfcaiFdrhFpXaMoFFrr0PUDus7DEbiu6xZZViBOtsgLDV3X6MOAYTfK6UO419rUyEuFiIcUk5aahpSABYpSSa8gIia1toPfB7TB/Y+BzOx7VMawQ4Mi19huS+S5EjBJWVbQVS1iTMjfbe/QeAsbOgETCbyDC70kiEpVwQ9kuw9wjlQqI8NMus1Lic01E3s/0g/kSMiIMJ9V3dBMA6VqMRVxrJbiMKG1vUARYZJu6RG5apwIdc7LHQ8xWNQYC8czbScCnCRi9lweFdLobYPPX7M8OM07fP6ecX2fcP054et6wss5kHON9x+zvPugu6+PIwLFzjJyaEyDMARqUGRy2lmL6RCE3PseL5cZz+cJx2mHeRqp1yHNcpyOB7y9ksDliCMJ985RMtoh72Sez5gIHDtN2elf+yEQyXwhPNOeWvpP5nLHO93tDtjvZ4zjROm0uCtpj38A6CcjzW7yn7AAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;grafana client fault inject&quot;
        title=&quot;grafana client fault inject&quot;
        src=&quot;/static/30cf39c76b02540fad215f5f0eb110cc/b9e4f/grafana-client-fault-inject.png&quot;
        srcset=&quot;/static/30cf39c76b02540fad215f5f0eb110cc/cf440/grafana-client-fault-inject.png 148w,
/static/30cf39c76b02540fad215f5f0eb110cc/d2d38/grafana-client-fault-inject.png 295w,
/static/30cf39c76b02540fad215f5f0eb110cc/b9e4f/grafana-client-fault-inject.png 590w,
/static/30cf39c76b02540fad215f5f0eb110cc/f9b6a/grafana-client-fault-inject.png 885w,
/static/30cf39c76b02540fad215f5f0eb110cc/2d849/grafana-client-fault-inject.png 1180w,
/static/30cf39c76b02540fad215f5f0eb110cc/f94bd/grafana-client-fault-inject.png 2380w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;To learn more about gRPC and Istio:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/concepts/traffic-management/#traffic-routing-and-configuration&quot;&gt;Istio docs - Traffic Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cloud.google.com/solutions/using-istio-for-internal-load-balancing-of-grpc-services&quot;&gt;Blog post - gRPC + Istio + Cloud Internal Load Balancer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[database traffic]]></title><description><![CDATA[Applications often span multiple environments, and databases are a great example. You might choose to run your database outside of‚Ä¶]]></description><link>https://istiobyexample.dev//databases/</link><guid isPermaLink="false">https://istiobyexample.dev//databases/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;Applications often span multiple environments, and databases are a great example. You might choose to run your database &lt;a href=&quot;https://cloud.google.com/blog/products/databases/to-run-or-not-to-run-a-database-on-kubernetes-what-to-consider&quot;&gt;outside of Kubernetes&lt;/a&gt; for legacy or storage reasons, or you might use a managed database service.&lt;/p&gt;
&lt;p&gt;But fear not! You can still add external databases to your Istio service mesh. Let‚Äôs see how.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/04b33c04eb17ac4c154c609022875b8b/ba4ff/diagram.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.52528602221854%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAJnKAACZygHjkaQiAAACLUlEQVQ4y5WTy27TQBSG89JIPAILVmxBbJB4AlasWbCoKlQpbZO0iRPq+BI7vo09Hl/m49hORUH0wkhHc5yMvnPO/P/MGJd9NHRtOb8w7P1uOmntGI+tWRRbXA/84EH44Mlvhwi+nxnevMv4+Fmhtf0D+q+Y3blQVj25qsmUJis0aaVJqgpVainW8v5TwZevFW17D+TxDsMQVJ1xVD5ZFZGaCB0cqbcxqi/GQ86OcfTf3fXYvsV2tYQ5RTN1GAgwLRPW3jVutMPZL6iuQtplSrp16RsP3y0wZgAKqFF00ZxeBZLn9CbDSvRVKHt+Dzyy9q8Jkj27/Yry0qfbFCRXN3TFHG+9Q2cRVgd0uUP57TX6xyswMSRLAayw6c1YYAQWVUZcBGTSaaJjTCoCrGNyuYpB6UGouu7G3DY1zeYDrfNW8gpbJ7IXUiyWPGXmyeGu7zGtptSF2MPlp78ll2p1o0eIJ6rX5mSwvpkAA+w07jjyAJY7HYF9P0luTMN2u+NwONBILnc/Ls+3Apx8+YTAk8rDyHlecDzGxHGMFwbotCQ7phRK/QV82oOjyuEBgSU4zobwEBIHEc15SDkPUKp8AORZD04+FGAcH1ktl4TRgWjj096kqAufPEjHQ3vvf4DyvLIs4e5uK2DpMAow4sNi7soLmoztBwKsXwgcXsHtumaxylgsM1brkltHy65YOzXDHV8uRLDmhcCus/JGB+ucQuw2fp9200z/36/ngL8ADFWH7FgjayIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;diagram&quot;
        title=&quot;diagram&quot;
        src=&quot;/static/04b33c04eb17ac4c154c609022875b8b/b9e4f/diagram.png&quot;
        srcset=&quot;/static/04b33c04eb17ac4c154c609022875b8b/cf440/diagram.png 148w,
/static/04b33c04eb17ac4c154c609022875b8b/d2d38/diagram.png 295w,
/static/04b33c04eb17ac4c154c609022875b8b/b9e4f/diagram.png 590w,
/static/04b33c04eb17ac4c154c609022875b8b/f9b6a/diagram.png 885w,
/static/04b33c04eb17ac4c154c609022875b8b/2d849/diagram.png 1180w,
/static/04b33c04eb17ac4c154c609022875b8b/ba4ff/diagram.png 6031w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Here, we have a &lt;code class=&quot;language-text&quot;&gt;plants&lt;/code&gt; service running inside a Kubernetes cluster, with Istio enabled. &lt;code class=&quot;language-text&quot;&gt;plants&lt;/code&gt; writes inventory to a &lt;a href=&quot;https://firebase.google.com/docs/firestore&quot;&gt;Firestore&lt;/a&gt; NoSQL database running in Google Cloud, using the Golang client library for Firestore. Its logs look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;writing a new plant to Firestore&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
‚úÖsuccess&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let‚Äôs say we want to monitor outgoing traffic to Firestore. To do this, we‚Äôll add an Istio &lt;a href=&quot;https://istio.io/docs/reference/config/networking/v1alpha3/service-entry/&quot;&gt;ServiceEntry&lt;/a&gt; corresponding to the hostname of the &lt;a href=&quot;https://cloud.google.com/firestore/docs/reference/rpc/&quot;&gt;Firestore API&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceEntry
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; firestore
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;firestore.googleapis.com&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; https
    &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HTTPS
  &lt;span class=&quot;token key atrule&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; MESH_EXTERNAL
  &lt;span class=&quot;token key atrule&quot;&gt;resolution&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DNS&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From here, we can see Firestore appear in Istio‚Äôs &lt;a href=&quot;https://istio.io/docs/tasks/telemetry/kiali/&quot;&gt;service graph&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ef259db8094d26ee52e769e902d4c25d/5b907/kiali-no-vs.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 24.67043314500942%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwUlEQVQY052QzWrDMBCE/f4v0qfIoZfWVQ/GkCj4YIf+QOr84NiSLCuW/VVq6aXJIWRgdliYWdhJ+Id5ni94K6I38d5jrcUYgx/Hq8ZhGLB9jwvK5HFuoA97pHPuJx81IlFKIaXkRQjePj45+wnrzvQhrLWm7TqWK0kqXlnKNY/Pgqc0Jcsy8jynLEuKoqCu69+DcXg/0inNrumoA3cnxXZ/pKoqqs2Gr0PDoTWBmoeF4H0bwvN0/eV7uvoLh3nR9TeaAoKaMCX85AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;kiali&quot;
        title=&quot;kiali&quot;
        src=&quot;/static/ef259db8094d26ee52e769e902d4c25d/b9e4f/kiali-no-vs.png&quot;
        srcset=&quot;/static/ef259db8094d26ee52e769e902d4c25d/cf440/kiali-no-vs.png 148w,
/static/ef259db8094d26ee52e769e902d4c25d/d2d38/kiali-no-vs.png 295w,
/static/ef259db8094d26ee52e769e902d4c25d/b9e4f/kiali-no-vs.png 590w,
/static/ef259db8094d26ee52e769e902d4c25d/f9b6a/kiali-no-vs.png 885w,
/static/ef259db8094d26ee52e769e902d4c25d/5b907/kiali-no-vs.png 1062w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Note that the traffic appears as TCP because the sidecar proxy for &lt;code class=&quot;language-text&quot;&gt;plants&lt;/code&gt; is receiving the firestore TLS traffic &lt;a href=&quot;https://github.com/istio/istio/issues/14933&quot;&gt;as plain TCP&lt;/a&gt;. The edge of the graph denote the number of request throughput to Firestore, in bits per second.&lt;/p&gt;
&lt;p&gt;Now let‚Äôs say we want to test &lt;code class=&quot;language-text&quot;&gt;plants&lt;/code&gt;‚Äôs behavior when it cannot connect to the database. We can do this with Istio, without changing any application code.&lt;/p&gt;
&lt;p&gt;While Istio currently does not support TCP fault injection, what we can do is create a &lt;a href=&quot;https://istio.io/docs/reference/config/networking/v1alpha3/virtual-service/#TCPRoute&quot;&gt;TCP traffic rule&lt;/a&gt; to send firestore API traffic to another ‚Äúblack hole‚Äù service, effectively breaking the client connection to Firestore.&lt;/p&gt;
&lt;p&gt;To do this, we can deploy a small &lt;code class=&quot;language-text&quot;&gt;echo&lt;/code&gt; service inside the cluster, and forward all &lt;code class=&quot;language-text&quot;&gt;firestore&lt;/code&gt; traffic to the &lt;code class=&quot;language-text&quot;&gt;echo&lt;/code&gt; service instead:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; fs
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; firestore.googleapis.com
  &lt;span class=&quot;token key atrule&quot;&gt;tcp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When we apply this Istio VirtualService to the cluster, the &lt;code class=&quot;language-text&quot;&gt;plants&lt;/code&gt; logs report errors:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;writing a new plant to Firestore&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
üö´ Failed adding plant: rpc error: code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Unavailable desc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; all SubConns are &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; TransientFailure&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And in the service graph, we can see that the &lt;code class=&quot;language-text&quot;&gt;firestore&lt;/code&gt; node has a purple &lt;code class=&quot;language-text&quot;&gt;VirtualService&lt;/code&gt; icon, meaning we‚Äôve applied an Istio traffic rule against that service. Eventually, throughput to firestore will appear as &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; over the last minute, since we‚Äôve redirected all outgoing connections to the database.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/008f5f1c59fb77af16c1aeea0e230655/0309e/kiali.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwklEQVQoz5VRbQuCMBj0//+qPvUxEiKQgkokdTab25wvc15TkZKs7ODg4XbP2O0cWLRtO+GozZ19YwdnHF4xGDAxLkHndcZBSgnOOXRdvxmLXPcsLdEApWqQiwpK1na2eqGfLxwv9H0fW9dFFBNo06LSDRhjCMMIwYXCPzF4e4LV+gBvF+LspQisFgcC5CrnI1e1RioUbpkA5RIkoUgIwV1wZEqB2hSb4wVFqX5H/uev+h2bouenUpY2aYwZlmca7vAA4L0lhYC56bsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;kiali&quot;
        title=&quot;kiali&quot;
        src=&quot;/static/008f5f1c59fb77af16c1aeea0e230655/b9e4f/kiali.png&quot;
        srcset=&quot;/static/008f5f1c59fb77af16c1aeea0e230655/cf440/kiali.png 148w,
/static/008f5f1c59fb77af16c1aeea0e230655/d2d38/kiali.png 295w,
/static/008f5f1c59fb77af16c1aeea0e230655/b9e4f/kiali.png 590w,
/static/008f5f1c59fb77af16c1aeea0e230655/f9b6a/kiali.png 885w,
/static/008f5f1c59fb77af16c1aeea0e230655/2d849/kiali.png 1180w,
/static/008f5f1c59fb77af16c1aeea0e230655/0309e/kiali.png 1280w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Note that you can also use Istio to manage traffic for databases &lt;em&gt;inside&lt;/em&gt; the cluster, including Redis, SQL, and &lt;a href=&quot;https://istio.io/blog/2018/egress-mongo/&quot;&gt;MongoDB&lt;/a&gt;. See the Istio docs to learn more.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[canary deployment]]></title><description><![CDATA[A canary deployment is a strategy for safely rolling out a new version of a service. With Istio, you can use percentage-based traffic‚Ä¶]]></description><link>https://istiobyexample.dev//canary/</link><guid isPermaLink="false">https://istiobyexample.dev//canary/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;A canary deployment is a strategy for safely rolling out a new version of a service. With Istio, you can use percentage-based &lt;a href=&quot;https://istio.io/docs/concepts/traffic-management/#routing-versions&quot;&gt;traffic splitting&lt;/a&gt; to direct a small amount of traffic to the new version. Then you can run a &lt;a href=&quot;https://cloud.google.com/blog/products/devops-sre/canary-analysis-lessons-learned-and-best-practices-from-google-and-waze&quot;&gt;canary analysis&lt;/a&gt; on v2 (like check latency and error rate), and finally direct more traffic at the new version until it‚Äôs serving all traffic.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c2548d68d472716f3d1bb5154f80c342/95779/canary_diagram.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.26678932842687%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAJnKAACZygHjkaQiAAABpElEQVQoz32TC1OjQBCE+f+/zSpPvWgSDRElJITXEhBNWOa7WR6RK+uOqmFmqN3e7tnG43+PyCzL2Moshv7SQtcNnecWfYfM8ghwrQeQ1gplA0UFphL2KSS5RjFgeDM6szxF94PPPoFya6gryyaE5VZ48iEzYJWl56gaPe1UwyGV/iR3en6CL5WCzZCPB222SBuT7SIuTzGnoORBgZa+cLcaAB2W11p4jeBtL/x+gc27cPZTzK6mMEc4b5BmrTlCziFJXFGtMsp9w/0GVspw9Sq97B7Q6b5fuxBedvAenOl8ZfCcU6QHaENluFB2RS85K1WJlokqiNNxhtqb03gpTvc6gEAZ+jqTKNYTwpTmoAxrt8Qin8qyvtO6IdbNx+eSJPxk9TYQuV26cY2XYu3QHHM3cCE1wwwTzdWHfF+Te50XpIHPJawwquB20XHziM5Q9xWj5J6DFlbt4LKzxaVVe7QjWO+j7mrJNPnS+8moA8OvpRBEw9ydbDvN8F/WmTx5BdZvjvnxaMnNoMY5w6lzdS/5b2P/jAls+ku6zpmbPuaqprV/AHPHVhz9Pr0pAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Diagram&quot;
        title=&quot;Diagram&quot;
        src=&quot;/static/c2548d68d472716f3d1bb5154f80c342/b9e4f/canary_diagram.png&quot;
        srcset=&quot;/static/c2548d68d472716f3d1bb5154f80c342/cf440/canary_diagram.png 148w,
/static/c2548d68d472716f3d1bb5154f80c342/d2d38/canary_diagram.png 295w,
/static/c2548d68d472716f3d1bb5154f80c342/b9e4f/canary_diagram.png 590w,
/static/c2548d68d472716f3d1bb5154f80c342/f9b6a/canary_diagram.png 885w,
/static/c2548d68d472716f3d1bb5154f80c342/2d849/canary_diagram.png 1180w,
/static/c2548d68d472716f3d1bb5154f80c342/95779/canary_diagram.png 4348w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; helloworld
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; helloworld
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; helloworld
        &lt;span class=&quot;token key atrule&quot;&gt;subset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
      &lt;span class=&quot;token key atrule&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;90&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; helloworld
        &lt;span class=&quot;token key atrule&quot;&gt;subset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v2
      &lt;span class=&quot;token key atrule&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DestinationRule
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; helloworld
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; helloworld
  &lt;span class=&quot;token key atrule&quot;&gt;subsets&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
    &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v2
    &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[jwt]]></title><description><![CDATA[A JSON Web Token (JWT) is a type of authentication token used to identify a user to a server application. JWTs contain information about the‚Ä¶]]></description><link>https://istiobyexample.dev//jwt/</link><guid isPermaLink="false">https://istiobyexample.dev//jwt/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;A &lt;a href=&quot;https://jwt.io/introduction/&quot;&gt;JSON Web Token&lt;/a&gt; (JWT) is a type of authentication token used to identify a user to a server application. JWTs contain information about the client caller, and can be used as part of a client session architecture. A &lt;a href=&quot;https://auth0.com/docs/jwks&quot;&gt;JSON Web Key Set&lt;/a&gt; (JWKS) contains the cryptographic keys used to verify incoming JWTs.&lt;/p&gt;
&lt;p&gt;You can use Istio‚Äôs &lt;a href=&quot;https://istio.io/docs/reference/config/istio.authentication.v1alpha1/#Jwt&quot;&gt;Authentication API&lt;/a&gt; to &lt;a href=&quot;https://istio.io/docs/concepts/security/#origin-authentication&quot;&gt;configure JWT policies&lt;/a&gt; for your services.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/29ed7235f86b47337cbda24bc10ac9bd/700db/jwt.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 49.64447317388494%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAJnKAACZygHjkaQiAAABfElEQVQoz32S207bQBRF/e2ID6hEqFSpP1BV4qGv5amioik8VFRUuSAlLokdZ4gdO75hz5zFYAdwCulIW+cizd7n5vCfJyINun4Ty27chfNWsiF4/MUL2b9CW+9VEc6+ytgRENJSNzCmJalrsQBtrdYtnisMw5BFEKACxTqKn7UbbIu4uas5HaZcL0qKTNisrUhkSDeQWBsqQ5ZYwqqo6Y9/cJJ84oM64ufNOVQxUvlIHSGmtHQFcZLgX86IVMYmh9JVVEOXcJ4TzA3ziSaYaRxdaS5Gfb6sP/MxeM/Z4CvkEyS/RkoXuZ/bvjz09Jz6doWe3FJEY/Lf39DukKD/i5mrmQ40/l9L6Ps+x71jDg8O6b3rMRqNd1vezlVnFdmfBZUXkqbW9wryYchqlnIXCN5UozyDk9hWlsslSqlmlk/bEzHtALubt900C6kgW03JwwFZnBLbb+uV4b6U11t+6/a6p9IaK1Zcwea7TSQ7J7T/DveRNvFT8dKxLR4AvPcEvB1yW9UAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;jwt&quot;
        title=&quot;jwt&quot;
        src=&quot;/static/29ed7235f86b47337cbda24bc10ac9bd/b9e4f/jwt.png&quot;
        srcset=&quot;/static/29ed7235f86b47337cbda24bc10ac9bd/cf440/jwt.png 148w,
/static/29ed7235f86b47337cbda24bc10ac9bd/d2d38/jwt.png 295w,
/static/29ed7235f86b47337cbda24bc10ac9bd/b9e4f/jwt.png 590w,
/static/29ed7235f86b47337cbda24bc10ac9bd/f9b6a/jwt.png 885w,
/static/29ed7235f86b47337cbda24bc10ac9bd/2d849/jwt.png 1180w,
/static/29ed7235f86b47337cbda24bc10ac9bd/700db/jwt.png 6188w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In this example, we require a JWT for all routes in the &lt;code class=&quot;language-text&quot;&gt;frontend&lt;/code&gt; service except for the home page (&lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;) and the pod health check (&lt;code class=&quot;language-text&quot;&gt;/_healthz&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;In the Istio policy, we specify the path to a test public key (&lt;code class=&quot;language-text&quot;&gt;jwksUri&lt;/code&gt;), which will be mounted into the frontend‚Äôs sidecar proxy. All unauthenticated requests will receive a &lt;code class=&quot;language-text&quot;&gt;401 - Unauthorized&lt;/code&gt; status from Envoy.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;authentication.istio.io/v1alpha1&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Policy&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;frontend-jwt&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;targets&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; frontend
  &lt;span class=&quot;token key atrule&quot;&gt;origins&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;jwt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;issuer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;testing@secure.istio.io&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;jwksUri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://raw.githubusercontent.com/istio/istio/release-1.2/security/tools/jwt/samples/jwks.json&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;trigger_rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;excluded_paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;exact&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /_healthz
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;exact&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /
  &lt;span class=&quot;token key atrule&quot;&gt;principalBinding&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; USE_ORIGIN&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To learn more and try interactive examples, see the &lt;a href=&quot;https://istio.io/docs/tasks/security/authn-policy/#end-user-authentication&quot;&gt;Istio docs&lt;/a&gt; and the &lt;a href=&quot;https://github.com/GoogleCloudPlatform/istio-samples/tree/master/security-intro#add-end-user-jwt-authentication&quot;&gt;istio-samples repo&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[external services]]></title><description><![CDATA[A service mesh often spans one environment‚Äî for instance, one Kubernetes cluster. And together, all the connected services in that‚Ä¶]]></description><link>https://istiobyexample.dev//external-services/</link><guid isPermaLink="false">https://istiobyexample.dev//external-services/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;A &lt;a href=&quot;https://istio.io/docs/concepts/what-is-istio/#what-is-a-service-mesh&quot;&gt;service mesh&lt;/a&gt; often spans one environment‚Äî for instance, one Kubernetes cluster. And together, all the connected services in that environment form the management domain of that mesh, from which you can view metrics and set policies.&lt;/p&gt;
&lt;p&gt;But what if you are also running services &lt;em&gt;outside&lt;/em&gt; the cluster, or you depend on external APIs?&lt;/p&gt;
&lt;p&gt;Have no fear. Istio provides a resource called a &lt;a href=&quot;https://istio.io/docs/concepts/traffic-management/#service-entries&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;ServiceEntry&lt;/code&gt;&lt;/a&gt; that lets you logically bring external services into your mesh ‚Äî even services you don‚Äôt own.&lt;/p&gt;
&lt;p&gt;When you create a ServiceEntry for an external hostname, you can view metrics and traces reaching all the way to that external service. You can even set traffic policies like &lt;a href=&quot;/retry/&quot;&gt;retry logic&lt;/a&gt; on those external services. Adding &lt;code class=&quot;language-text&quot;&gt;ServiceEntries&lt;/code&gt; effectively expands the reach of your Istio management domain. Let‚Äôs see an example.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1f1887d8d4790fe64dd6616441e58b2b/bafa1/currency.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.16852039096731%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAJnKAACZygHjkaQiAAABX0lEQVQoz5WSW04DMQxFZ/fsgB++kdgAbIBVgBBFPNoymWcn47xzsTO0aqvygaUrOx8+uXFc4Z+Rcz7k43ofVYyA8/lPWZfx8Jhxe58RIk5g51BR9d1kbBtg2AH9uKgTDUuteuD6Dri6ydAkzfmi6wNQmq33sEmDwsR5hosElwzXVABkM+pWGhdA4GcZ50pfPgNXxdGsoUhhMCMa02L3vIF5UVx3+JzWWPVb1L00B5Cz7NQsUGsxTmyC4Skt6ALsf4FjnFGrDWilEFY9uqbGB63xNXZ4UxqjH/E+bKCaBkopeAbNWhcgWYfIlxwcttRAe8kt6FXBPSmQmcutMSzzlEj8rJmdEcuFUJyKBCi5zJCch4kaMwOJXdpAPJ8ZhufICPiQ0Q7Lh8gcZVYppQLwYVHkc3ly02dMbMS4xLecylhZHWCn98DTnbv02xU75TXJ6GVt9hqPlUsWl8cOL0niB08BC/8esVvwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;external currency service&quot;
        title=&quot;external currency service&quot;
        src=&quot;/static/1f1887d8d4790fe64dd6616441e58b2b/b9e4f/currency.png&quot;
        srcset=&quot;/static/1f1887d8d4790fe64dd6616441e58b2b/cf440/currency.png 148w,
/static/1f1887d8d4790fe64dd6616441e58b2b/d2d38/currency.png 295w,
/static/1f1887d8d4790fe64dd6616441e58b2b/b9e4f/currency.png 590w,
/static/1f1887d8d4790fe64dd6616441e58b2b/f9b6a/currency.png 885w,
/static/1f1887d8d4790fe64dd6616441e58b2b/2d849/currency.png 1180w,
/static/1f1887d8d4790fe64dd6616441e58b2b/bafa1/currency.png 5934w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Here, we‚Äôre running a global store website with a &lt;code class=&quot;language-text&quot;&gt;currency&lt;/code&gt; service, responsible for converting product prices based on a user‚Äôs locality. We rely on an third-party currency conversion API, the &lt;a href=&quot;https://www.ecb.europa.eu/stats/policy_and_exchange_rates/euro_reference_exchange_rates/html/index.en.html&quot;&gt;European Central Bank&lt;/a&gt;, to provide realtime exchange rates.&lt;/p&gt;
&lt;p&gt;We want to set a 3-second timeout on all calls from services inside the mesh to this external API. We‚Äôll need two Istio resources to do this.&lt;/p&gt;
&lt;p&gt;First, a &lt;code class=&quot;language-text&quot;&gt;ServiceEntry&lt;/code&gt;, which logically adds the European Central Bank‚Äôs hostname, &lt;code class=&quot;language-text&quot;&gt;ecb.europa.eu&lt;/code&gt;, to the mesh:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceEntry
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; currency&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;api
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; www.ecb.europa.eu
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http
    &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HTTP
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; https
    &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HTTPS&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Second, a &lt;code class=&quot;language-text&quot;&gt;VirtualService&lt;/code&gt; traffic rule, to set a timeout for calls to the API:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; currency&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;timeout
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; www.ecb.europa.eu
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 3s
    &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; www.ecb.europa.eu
        &lt;span class=&quot;token key atrule&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Once we create a ServiceEntry for the currency API, we can automatically see &lt;code class=&quot;language-text&quot;&gt;ecb.europa.eu&lt;/code&gt; in our &lt;a href=&quot;https://istio.io/docs/tasks/telemetry/kiali/&quot;&gt;Kiali service graph&lt;/a&gt; (and instantly know &lt;em&gt;who&lt;/em&gt;‚Äôs calling it):&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/74cae8deb37ee425ce2ccda62a758c27/b4b41/servicegraph.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.52505609573672%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiklEQVQoz5VS7U7CQBDkUaBAKVYRsCKK0RdX30ESFPhhNJG2GBIjAr2PtuPtQiuC/vCayW4ve7Mzmy2UbQf17jXanodSyTIooVgswrIsRrlcRqVSQbVaZVBu2zaDcsdxGLVaDa7rouC2Oqi3ztDq9HBze4f7fh+DwQDj8Rij0QjD4ZCR5RR377dRaJ72YLstUHx6foFOASEElFKI4xj/PUzoNjtodi7xMHrE22yK+eecMQl8jkSstWZkjbK7LM+wJjS2G945Xic+VKKxUksIHeFjtYDUEqn5kiTJVaQp/acc9xQSkdPwDOEFgjDMH8SJ6ZjGULHkXEjBCpI04VwpzXWkmJolm5wJD9tdY7kHPwiYMFNDj4lQaLGnJN001nptld6wZSIjtLtX8P1vwm07kVwhNLNd8AgEprMZFsslN5RS8ixzy7WjE1QOmjg2swyC8IfCnNREaezo3LJEZDaByKJovRFUSyjQ/Kq0Nmw53FP42+CzowxhOHs3m7DI6/4k3CbLuu9ib67m7gtrQ+GdPFf8hwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;service graph&quot;
        title=&quot;service graph&quot;
        src=&quot;/static/74cae8deb37ee425ce2ccda62a758c27/b9e4f/servicegraph.png&quot;
        srcset=&quot;/static/74cae8deb37ee425ce2ccda62a758c27/cf440/servicegraph.png 148w,
/static/74cae8deb37ee425ce2ccda62a758c27/d2d38/servicegraph.png 295w,
/static/74cae8deb37ee425ce2ccda62a758c27/b9e4f/servicegraph.png 590w,
/static/74cae8deb37ee425ce2ccda62a758c27/f9b6a/servicegraph.png 885w,
/static/74cae8deb37ee425ce2ccda62a758c27/2d849/servicegraph.png 1180w,
/static/74cae8deb37ee425ce2ccda62a758c27/b4b41/servicegraph.png 2674w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;And we also get an automatic &lt;a href=&quot;https://istio.io/docs/tasks/telemetry/metrics/using-istio-dashboard/&quot;&gt;Grafana dashboard&lt;/a&gt; for this external service, to view data like response codes and latency:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/765399be3d8aab886e29b2007d8a6516/9d68f/grafana.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 38.773079213817745%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABY0lEQVQoz2VRa0/DMAzsl21IIBil7zZpk6aPlQ1auiH+/x87zpkqIfHBOju5u9hxEL88orYdmsbCuh6qaZFkJdKcUSjmhceYGCUZ0pK5IGvR6NrA2hZDW8M0BsHT8xFxXnlCnBbIjEOmGi9MiRmx/1hgxwmuH6H4aBSn3lRQ4i1KEEZE5kEYhojjDDlNc+kqzZEwMj4gtYRWGmVZQVUKZUEeO5YGtti0ogmOx1cobXAa37Fef2DbHjXHMOz0cpl59g3nBo7XoutOGIYJ03RhPsJ1AzS1wpuXG2pygsPhwR9a/uMwnlHTSOmGphYtzfv+5M3kEcdxxVzMhC86CeG5fuJ/WgT7/cGLRbiuN0+UWvB8/sSyXL2BmApHzuZ59SbC09r6Dpev73uHYlipGooLaEzr86q6h++UmxS8TzD5rzDkyQMbT2rrRmobBLvd3m9s29qWbyGbU1pz1I5C++/+77Yl/wUC2NhIhooNPwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;grafana&quot;
        title=&quot;grafana&quot;
        src=&quot;/static/765399be3d8aab886e29b2007d8a6516/b9e4f/grafana.png&quot;
        srcset=&quot;/static/765399be3d8aab886e29b2007d8a6516/cf440/grafana.png 148w,
/static/765399be3d8aab886e29b2007d8a6516/d2d38/grafana.png 295w,
/static/765399be3d8aab886e29b2007d8a6516/b9e4f/grafana.png 590w,
/static/765399be3d8aab886e29b2007d8a6516/f9b6a/grafana.png 885w,
/static/765399be3d8aab886e29b2007d8a6516/2d849/grafana.png 1180w,
/static/765399be3d8aab886e29b2007d8a6516/9d68f/grafana.png 3358w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://istio.io/docs/tasks/traffic-management/egress/egress-control/#manage-traffic-to-external-services&quot;&gt;See the Istio docs&lt;/a&gt; to learn more about managing and securing external services.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[load balancing]]></title><description><![CDATA[Kubernetes supports load balancing for inbound traffic. But what about Kubernetes services inside the cluster? When in-cluster services‚Ä¶]]></description><link>https://istiobyexample.dev//load-balancing/</link><guid isPermaLink="false">https://istiobyexample.dev//load-balancing/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;Kubernetes supports load balancing for &lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer&quot;&gt;inbound&lt;/a&gt; traffic. But what about Kubernetes services inside the cluster?&lt;/p&gt;
&lt;p&gt;When in-cluster services &lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/#proxy-mode-iptables&quot;&gt;communicate&lt;/a&gt;, a load balancer called kube-proxy &lt;a href=&quot;https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview#services&quot;&gt;forwards&lt;/a&gt; requests to service pods at random. You can use Istio to add more complex load balancing methods, enabled by Envoy.&lt;/p&gt;
&lt;p&gt;Envoy supports multiple load balancing methods, including &lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#random&quot;&gt;random&lt;/a&gt;, &lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#weighted-round-robin&quot;&gt;round-robin&lt;/a&gt;, and &lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#weighted-least-request&quot;&gt;least request&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Let‚Äôs see how to use Istio to add &lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#weighted-least-request&quot;&gt;&lt;strong&gt;least request&lt;/strong&gt;&lt;/a&gt; load balancing for a service called &lt;code class=&quot;language-text&quot;&gt;payments&lt;/code&gt;, which processes all transactions for a web &lt;code class=&quot;language-text&quot;&gt;frontend&lt;/code&gt;. The payments service is backed by three pods.&lt;/p&gt;
&lt;p&gt;In this least request algorithm, the client-side Envoy will first choose two instances at random. Then, it will forward the request to the instance with the fewest number of active requests, to help ensure even load balancing across all instances.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c3a984ef8540731916a890e0f734b7f0/b0ee1/least-requests.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.37630208333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAJnKAACZygHjkaQiAAACbklEQVQ4y3WUiU7bQBCG8/7vVKlSaUEQ0hAackAOx7l837fXXydO08ZAVxrtei1/+8/Mv+7RGQ1N05xXTdOJ6xGrgOd6wKHa8lZNcGuDefXSvuv9D/Ae0jQleaFRV2vcuM/a+sohvEP3b1l531m7X8iy5RnYfvwOcIGopmjXde2T50vZO2C7Q7Jng1z3eNsHaMeU4esCJ3ik1wVUKJW2keVTUbQQUHhdERkZ1vaBbOUTzk1G0yO6nfG02AhwIAqVQgioKqLINZLknjydCXBCreJ35Tg9RVjuLf54T6gZrAwHw0uY6RMBPtFTvo0KPVQgcxxSO67MjhxyUa2uoG3yeNGIQ/ATK3rCcAdszT5HR4SUIb16+0Zt7VCWTqGZpBOLynT/Znit7tIoKywx1xa+F7M2PZYHVyIgzioBbubUho46LsmmAt2FpC+y19gCqK/q+6/zthGQjg9EK4eVgMKk4NfKxglTAZ5ggYPyDGovIn+VlP2AsthRFGvKci8lzv5Az3BTd0hfDcKZwc1QZy0HjJbmGdhkCSry2igTjSKdUERTgekC21FVtqxXLfzScTdSok4y8TKOfoIpTdmYKUFcd22Tl0uStE+UfCPNRuK7uai6+DBsfZimN9KAPgtngGbfszHuJO07dtYPymp/Mfa5kyf/pdmzOH4sALdj8qoyZH8qqsdij3uiidTccdh7PpYfs9jPccN+9+pd2+Sz66jqk9pQjP1IMncJX00exjsWh5iH2Qk4Oqf8Edp82Dv/ONrCSJf70mWbeOEx1XySHN52S2x/3AV+ButGmzxWcMfx8IzrT9HMIbPNgOX+K0mm8Rsho4AHrF7EZAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;load balancing&quot;
        title=&quot;load balancing&quot;
        src=&quot;/static/c3a984ef8540731916a890e0f734b7f0/b9e4f/least-requests.png&quot;
        srcset=&quot;/static/c3a984ef8540731916a890e0f734b7f0/cf440/least-requests.png 148w,
/static/c3a984ef8540731916a890e0f734b7f0/d2d38/least-requests.png 295w,
/static/c3a984ef8540731916a890e0f734b7f0/b9e4f/least-requests.png 590w,
/static/c3a984ef8540731916a890e0f734b7f0/f9b6a/least-requests.png 885w,
/static/c3a984ef8540731916a890e0f734b7f0/2d849/least-requests.png 1180w,
/static/c3a984ef8540731916a890e0f734b7f0/b0ee1/least-requests.png 6144w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;To enable this functionality, we create an Istio &lt;a href=&quot;https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/&quot;&gt;DestinationRule&lt;/a&gt; with a &lt;a href=&quot;https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#LoadBalancerSettings-SimpleLB&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;LEAST_CONN&lt;/code&gt;&lt;/a&gt; load balancer:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DestinationRule
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; payments&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;load&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;balancer
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; payments.prod.svc.cluster.local
  &lt;span class=&quot;token key atrule&quot;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;loadBalancer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;simple&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; LEAST_CONN&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Check out the &lt;a href=&quot;https://istio.io/docs/concepts/traffic-management/#load-balancing-3-subsets&quot;&gt;Istio docs&lt;/a&gt; to see how to add multiple load balancing methods for a single host.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[path-based routing]]></title><description><![CDATA[Istio and Envoy work at the Application traffic layer (L7), allowing you to direct and load-balance traffic based on attributes like HTTP‚Ä¶]]></description><link>https://istiobyexample.dev//path-based-routing/</link><guid isPermaLink="false">https://istiobyexample.dev//path-based-routing/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;Istio and &lt;a href=&quot;https://istio.io/docs/concepts/what-is-istio/#envoy&quot;&gt;Envoy&lt;/a&gt; work at the Application traffic layer (L7), allowing you to direct and load-balance traffic based on attributes like HTTP headers. This example shows how to direct traffic &lt;a href=&quot;https://istio.io/docs/concepts/traffic-management/#match-request-uri&quot;&gt;based on the request URI&lt;/a&gt; path.&lt;/p&gt;
&lt;p&gt;In this example, &lt;code class=&quot;language-text&quot;&gt;myapp&lt;/code&gt; is the server backend for a website, used by the &lt;code class=&quot;language-text&quot;&gt;frontend&lt;/code&gt;. An engineering team has implemented a new user authentication service, &lt;code class=&quot;language-text&quot;&gt;auth&lt;/code&gt;, which now operates as a separate service.&lt;/p&gt;
&lt;p&gt;Using an Istio &lt;a href=&quot;https://istio.io/docs/reference/config/networking/v1alpha3/virtual-service/#HTTPMatchRequest&quot;&gt;match rule&lt;/a&gt;, we redirect any request with the &lt;code class=&quot;language-text&quot;&gt;/login&lt;/code&gt; prefix to the new &lt;code class=&quot;language-text&quot;&gt;auth&lt;/code&gt; service, and direct all other &lt;code class=&quot;language-text&quot;&gt;myapp&lt;/code&gt; requests to the existing backend.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/549fa78eb8e1f4245156becb55891d6c/4b018/urimatch.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.709009153685564%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAJnKAACZygHjkaQiAAABwElEQVQoz32TCVPbMBCF8///VWc6HShlSsnVAgnEIbaxY/mWLUvy1w2loVyVZ2e9Op7evl1N+GCM43j0b8xbRp7MO5k7mH9cm7x74Gj+3cucK+i3ASaLMe2KvrqhL3/hhorJ+/RehrZXDDrE2xZrEprdCf1C0c0jOrWQtXtMvZZ9GZPa1URDSDxEZC4jN4rMy2Yvh9sdOp/SpifiLzFNICz2dLEw+pmhpyE6vhCg5BnwADbrpgQ24K5Yoc9Cyr0iUKd06Sn0AaNrhLV7Ttkqmd5goh1GrzGSsqmu/qQc25gv9Wdmbs5yeQ7BQL2MuMkDvi5i5hvRaxjxIoP3/qkoDicFsaMVPeVfYu/do1aTQ6rn7TeWZsm6uKa7fCAPYyr5us4zv0v59GPL9DY9Mixaw15p8saQlpqk0MSqRfeWSeMbEpuwtyn5mFNIBZV47fQRoB8cm4eSTVyijRWwluZ7jN6WLLaK26jgcp2iqu5Vlce3vejH8QXwSoBPzzb4m5xqljC7euA6zLlYJeR1//8+/HvLyxiirKEQsGqTE6Q14b7h6l6h6u6DPnzF8t9XcxitaKW0oewHsrJ71C+TdAfr+Q3Af1DuJHpbcwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;URI Match with Istio&quot;
        title=&quot;URI Match with Istio&quot;
        src=&quot;/static/549fa78eb8e1f4245156becb55891d6c/b9e4f/urimatch.png&quot;
        srcset=&quot;/static/549fa78eb8e1f4245156becb55891d6c/cf440/urimatch.png 148w,
/static/549fa78eb8e1f4245156becb55891d6c/d2d38/urimatch.png 295w,
/static/549fa78eb8e1f4245156becb55891d6c/b9e4f/urimatch.png 590w,
/static/549fa78eb8e1f4245156becb55891d6c/f9b6a/urimatch.png 885w,
/static/549fa78eb8e1f4245156becb55891d6c/2d849/urimatch.png 1180w,
/static/549fa78eb8e1f4245156becb55891d6c/4b018/urimatch.png 6227w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; auth&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;redirect
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; myapp
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/login&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; auth
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; myapp&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[ingress]]></title><description><![CDATA[Ingress traffic refers to traffic entering the mesh from outside the cluster. Kubernetes provides ways to handle ingress traffic. With Istio‚Ä¶]]></description><link>https://istiobyexample.dev//ingress/</link><guid isPermaLink="false">https://istiobyexample.dev//ingress/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;Ingress traffic refers to traffic entering the mesh from outside the cluster. Kubernetes &lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer&quot;&gt;provides&lt;/a&gt; &lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/ingress/&quot;&gt;ways&lt;/a&gt; to handle ingress traffic. With Istio, you can instead manage ingress traffic with a &lt;strong&gt;Gateway&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;A &lt;a href=&quot;https://istio.io/docs/reference/config/networking/v1alpha3/gateway/&quot;&gt;Gateway&lt;/a&gt; is a standalone set of Envoy proxies that load-balance inbound traffic. Istio deploys a default &lt;code class=&quot;language-text&quot;&gt;IngressGateway&lt;/code&gt; with a public IP address, which you can configure to expose applications inside your service mesh to the Internet.&lt;/p&gt;
&lt;p&gt;Istio Gateways have two key advantages over traditional Kubernetes Ingress. Because a Gateway is another Envoy proxy, you can use Istio to configure Gateway traffic in the same way you would configure east-west traffic between services (traffic splitting, redirects, retry logic).&lt;/p&gt;
&lt;p&gt;Gateways also forward metrics (request rate, error rate) just like &lt;a href=&quot;https://istio.io/docs/concepts/what-is-istio/#envoy&quot;&gt;sidecar&lt;/a&gt; proxies, allowing you to view Ingress traffic in &lt;a href=&quot;https://istio.io/docs/tasks/telemetry/kiali/#generating-a-service-graph&quot;&gt;a service graph&lt;/a&gt;, and set fine-grained &lt;a href=&quot;https://landing.google.com/sre/sre-book/chapters/service-level-objectives/&quot;&gt;SLOs&lt;/a&gt; on frontend services directly serving clients.&lt;/p&gt;
&lt;p&gt;Let‚Äôs see Gateways in action.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bd3ed1fb3d81ea46d223ab1adf06820d/94e46/ingress.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 128.32832832832833%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsSAAALEgHS3X78AAADc0lEQVRIx42UyW7bSBCG9YC+TJ7Bj5FLggC5zWUAHwaY5BbkklMGmRiBM3Ecw1asaKG1RDJl7TtX0VyaS/9TTYoiPQ5kkSp0q1n99V/V1V3AIw/nPG51XUelUkX9+hq1moSaJKFcLkPT9K2fsMJjwCiK4rbd7qDZaEDRTWiqAte2UK1UMBr0tn47gemKUZQolLtdvC/e4nIYoK8ydDWgJLVQbo/vRbK3wvF4jMFkce9brVrBRUfB8i7aQgtJJ7G0n1coLAgCHB8f4/Wrv/Dv5xN8OzvD9+Ilzr9+gWL5qE+9ZHEBTGF5y4fg+z5KpRKOjo5weHiI3548wcHBAZ49e47ZZISJGaG7ygHzqrL8ZUCRw7QfhiEURUGr1YLtOPHYVd+GzXIhixS5LtDtpTm7h96ZX8sN8GPoZCmit2DT/5NT4O07jvNLCjHIdveBhRxhEIH5YQz5MXAwN4PN0jyOrKDS9r/8HXj6AvjnE8dKAQyDQ9fIdDJjYyaN3wEmCQgpopLMUOx4cGhspXI4boItiEJ/+w7440+O0SQZDKMs4FSZKEfrcwdKfY6Tngtp5GzT4jgchrmpQ8YAEfZ8ySkU+kwznfoUdnkEuzqG05jFjs71FL68xPK8j/cf+rka4/Bok811rrCpzDYDPFYVGg7WZ12YpEiA3Jsl9L8bCcNmCKuj2I9HyRzX4zQfGVAo0w1sgcLxrtiHXZvA66vw5BWMjy2wiYGA/lvFRGEGxH0g1W68EfmCfnC2abJ10cPtJzne6bzvDiDfFnVs4gbZ3CLpMqWxCyfMfHcoxE6FKbE69OAy7K9Q/LzIgx3ZcCM3NtE3wzU8WPg+1qB6Yna0W6GeAw5YHz+9Vmwtt4k+62HuL6BhgTfSEGVjACNabaU/CuwyGZJbgxqoBJqj7W1KRtbx5XUTM82EQnDspZCeG6+DS/sCU38KPVRRsW5Qk2dU7HQ72z5WxSYtNNtTIT09dovj9Ud8tU7RZnWcaj/xgU6IW5vG3+ff6pgaw/2BHa+NqlMBo82xQgsNJgkv+OUZ2NUUmnSLRbjYP4eyJ6NkX6HhNnDtSmg6TdqENUxmQOuPY9g8mGc5dH8BTM+yeNbcIIAWt8JMrkMJl1CiJVR6VwT04W0VigvmAVBcXQbdeRrdgSYV+f9tnZqetOIgCF8xZ7EkHzMB/gcMqczAUmM0PwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ingress&quot;
        title=&quot;ingress&quot;
        src=&quot;/static/bd3ed1fb3d81ea46d223ab1adf06820d/b9e4f/ingress.png&quot;
        srcset=&quot;/static/bd3ed1fb3d81ea46d223ab1adf06820d/cf440/ingress.png 148w,
/static/bd3ed1fb3d81ea46d223ab1adf06820d/d2d38/ingress.png 295w,
/static/bd3ed1fb3d81ea46d223ab1adf06820d/b9e4f/ingress.png 590w,
/static/bd3ed1fb3d81ea46d223ab1adf06820d/f9b6a/ingress.png 885w,
/static/bd3ed1fb3d81ea46d223ab1adf06820d/2d849/ingress.png 1180w,
/static/bd3ed1fb3d81ea46d223ab1adf06820d/94e46/ingress.png 3996w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Here, the &lt;code class=&quot;language-text&quot;&gt;hello&lt;/code&gt; application runs in a container, inside a Pod. The Pod has an injected Istio sidecar proxy container. A Kubernetes Service called &lt;code class=&quot;language-text&quot;&gt;hello&lt;/code&gt; fronts this Pod. We want to direct inbound traffic from &lt;code class=&quot;language-text&quot;&gt;hello.com&lt;/code&gt; to the &lt;code class=&quot;language-text&quot;&gt;hello&lt;/code&gt; Service.&lt;/p&gt;
&lt;p&gt;First we need a &lt;code class=&quot;language-text&quot;&gt;Gateway&lt;/code&gt; resource, which opens port &lt;code class=&quot;language-text&quot;&gt;80&lt;/code&gt; in the default Istio &lt;code class=&quot;language-text&quot;&gt;IngressGateway&lt;/code&gt;, for all hosts resolving from the &lt;code class=&quot;language-text&quot;&gt;hello.com&lt;/code&gt; domain.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Gateway
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; hello&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;gateway
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;istio&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ingressgateway &lt;span class=&quot;token comment&quot;&gt;# use the default IngressGateway&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;servers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HTTP
    &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello.com&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(&lt;strong&gt;Note&lt;/strong&gt;: on your own, you‚Äôll still have to resolve the DNS for that host to the Istio &lt;code class=&quot;language-text&quot;&gt;IngressGateway&lt;/code&gt; external IP address.)&lt;/p&gt;
&lt;p&gt;Second, we need a &lt;a href=&quot;https://istio.io/docs/tasks/traffic-management/ingress/ingress-control/&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;VirtualService&lt;/code&gt;&lt;/a&gt; to direct traffic from the &lt;code class=&quot;language-text&quot;&gt;IngressGateway&lt;/code&gt; to the &lt;code class=&quot;language-text&quot;&gt;hello&lt;/code&gt; backend Service, running in the &lt;code class=&quot;language-text&quot;&gt;default&lt;/code&gt; namespace on port &lt;code class=&quot;language-text&quot;&gt;80&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; frontend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello.com&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;gateways&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; hello&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;gateway
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; hello.default.svc.cluster.local
        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[retry policy]]></title><description><![CDATA[Microservices architectures are distributed. This means more requests on the network, increasing the chance of transient failures like‚Ä¶]]></description><link>https://istiobyexample.dev//retry/</link><guid isPermaLink="false">https://istiobyexample.dev//retry/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;Microservices architectures are distributed. This means more requests on the network, increasing the chance of transient failures like network congestion.&lt;/p&gt;
&lt;p&gt;Adding retry policies for requests helps build resiliency in a services architecture. Often, this retry logic is &lt;a href=&quot;https://upgear.io/blog/simple-golang-retry-function/&quot;&gt;built into source code&lt;/a&gt;. But with Istio, you can define retry policies &lt;a href=&quot;https://istio.io/docs/concepts/traffic-management/#set-number-and-timeouts-for-retries&quot;&gt;with a traffic rule&lt;/a&gt;, offloading this logic to your services‚Äô &lt;a href=&quot;https://istio.io/docs/concepts/what-is-istio/#architecture&quot;&gt;sidecar proxies&lt;/a&gt;. This can help you standardize around the same policies across many services, protocols, and programming languages.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d04b1ed50b6173e601a8aeca559a7d52/8ddd4/retry.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.16132167152575%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAJnKAACZygHjkaQiAAABZUlEQVQoz32S3W6bQBCFef/nSq9ykTZpqmCTpI6htvkRGMdml92drwMEo6pRVhrtMDp7mDNnIr44IjLGUmD5ls/fRCJBQe4aQSwhWM17RGbSmWjOB6ydsNe3A94TuVDQh53GHhdyPA2BVvNSwe9La1eynp4DXhrF1oot9D4w80Q2vGoh00KFYYOvz5iHWgkcna3pOmhPgg+TxoDFnQouNzm2zmkuK94vKb2kE6HxCcnLT9ZxipE9XZxh1jV2k5NVLesEfsXC762QFxBvHH++raHqaX488vh0xyrefnSYDYTPtOct1nTa0w6T5HR3FX2hsjmyTWGfi/5U+P6AdtTTrt4wtyXn5IVdeU+axRj/OktWMnnChhUmJDivZCrJMcywUbnaTC0cCqGsBtFGR1TiipOad9HJNlrTeUo7EQ7OTE5/hFKNMbomn5gSVN5gyHE0xoXjGF6OI2n0//L9u2PL2iz5V3v4F0PYvBQdYfR+AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Diagram&quot;
        title=&quot;Diagram&quot;
        src=&quot;/static/d04b1ed50b6173e601a8aeca559a7d52/b9e4f/retry.png&quot;
        srcset=&quot;/static/d04b1ed50b6173e601a8aeca559a7d52/cf440/retry.png 148w,
/static/d04b1ed50b6173e601a8aeca559a7d52/d2d38/retry.png 295w,
/static/d04b1ed50b6173e601a8aeca559a7d52/b9e4f/retry.png 590w,
/static/d04b1ed50b6173e601a8aeca559a7d52/f9b6a/retry.png 885w,
/static/d04b1ed50b6173e601a8aeca559a7d52/2d849/retry.png 1180w,
/static/d04b1ed50b6173e601a8aeca559a7d52/8ddd4/retry.png 5145w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In this example, all inbound requests to the &lt;code class=&quot;language-text&quot;&gt;helloworld&lt;/code&gt; service try 5 times, and an attempt is marked as failed if it takes longer than 2 seconds to complete.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DestinationRule
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; helloworld
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; helloworld
  &lt;span class=&quot;token key atrule&quot;&gt;subsets&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
    &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; helloworld
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; helloworld
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; helloworld
        &lt;span class=&quot;token key atrule&quot;&gt;subset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
    &lt;span class=&quot;token key atrule&quot;&gt;retries&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;attempts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;perTryTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 2s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[authorization]]></title><description><![CDATA[Authentication means verifying the identity of a client. Authorization, on the other hand, verifies the permissions of that client, or: ‚Äúcan‚Ä¶]]></description><link>https://istiobyexample.dev//authorization/</link><guid isPermaLink="false">https://istiobyexample.dev//authorization/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;Authentication means verifying the identity of a client. &lt;strong&gt;Authorization&lt;/strong&gt;, on the other hand, verifies the permissions of that client, or: ‚Äúcan this service do what they‚Äôre asking to do?‚Äù&lt;/p&gt;
&lt;p&gt;Kubernetes supports authorization through &lt;strong&gt;role-based access control&lt;/strong&gt; (&lt;a href=&quot;https://kubernetes.io/docs/reference/access-authn-authz/rbac/#api-overview&quot;&gt;RBAC&lt;/a&gt;). In this model, you can map a &lt;strong&gt;role&lt;/strong&gt; (a set of permissions) to a &lt;strong&gt;role binding&lt;/strong&gt; (who exactly has these permissions?).&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://istio.io/docs/concepts/security/#authorization&quot;&gt;Istio uses RBAC&lt;/a&gt; to allow you to set authorization policies between services in your cluster. Let‚Äôs see how.&lt;/p&gt;
&lt;p&gt;Here, the &lt;em&gt;ShoeStore&lt;/em&gt; application is deployed to the &lt;code class=&quot;language-text&quot;&gt;default&lt;/code&gt; Kubernetes namespace. There are three services, and all speak plain HTTP:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;shoes&lt;/code&gt;: exposes an API for all the shoes in the store&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;users&lt;/code&gt;: stores purchase history&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;inventory&lt;/code&gt;: loads new shoe models into &lt;code class=&quot;language-text&quot;&gt;shoes&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4728ec40e0fa8a81c959ef33674b4d45/c51b9/rbac.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.86885513637106%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAJnKAACZygHjkaQiAAAB/UlEQVQoz4WSW2+bQBCF8/9/Tp8q9aVSValprdhJcwM7EMdgMDbYYMxtd+frBnKxo6odaSSGmTlzduac8WIiwrE9x6LVSa7SNYsmwK89JuUV08qlMNvXjt7PjhvEGGS/Q/IUs5wjVTmUiRkGYFBGeNpXXGcBSa1Z7yHeC+sSbIqzvtA29IBNhXEu0c4E499B1/LRniuTULH96eOGBU4K043wO7bj5IUhR6RN6GEe3SHWuv8XtSue6oBSlTx0IaPRGJYl5+e3OLkmysFZvwCaQ4HZJph8Y5d0gGyNmd8zqzyCNmKUXzAuLnEPM7IupdAN86eCehwT+DW+BXvM4HbFAKiXPjrykSRgFk2Iv12RXI94qGbEdUyLICfHgrQSskNHZncYF5ah9c3BDDvU4QOSLqFcsfv0mTrIKS98+DWyY6cQ2NwiwGSZPZg9knrea4G0lpoU1i09Y3M66W/RA+qlh97Yprt7mnFEd7fA7FJbu0VmHuK4yHiCnI+QKEBlMdUPy36R0qgpbRvSNF6vhPcd7jaYtsQUOeZgpWPUqS67zrLq7HtXNF++0rpb6vuIqhjTqaUFnQ+A/MN6SZlXDb4rQdFQ3yS0fmi/N6hubQEfhycPOvy7v+n/OK5rjHdrhe9iLr6j4ylKtmhd/J/hB7oDS2VXEa+RGwe8ObT6pOwPV7adVod1XP4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;shoes rbac&quot;
        title=&quot;shoes rbac&quot;
        src=&quot;/static/4728ec40e0fa8a81c959ef33674b4d45/b9e4f/rbac.png&quot;
        srcset=&quot;/static/4728ec40e0fa8a81c959ef33674b4d45/cf440/rbac.png 148w,
/static/4728ec40e0fa8a81c959ef33674b4d45/d2d38/rbac.png 295w,
/static/4728ec40e0fa8a81c959ef33674b4d45/b9e4f/rbac.png 590w,
/static/4728ec40e0fa8a81c959ef33674b4d45/f9b6a/rbac.png 885w,
/static/4728ec40e0fa8a81c959ef33674b4d45/2d849/rbac.png 1180w,
/static/4728ec40e0fa8a81c959ef33674b4d45/c51b9/rbac.png 6123w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;We want to authorize &lt;code class=&quot;language-text&quot;&gt;inventory&lt;/code&gt; to be able to &lt;code class=&quot;language-text&quot;&gt;POST&lt;/code&gt; new inventory to &lt;code class=&quot;language-text&quot;&gt;shoes&lt;/code&gt;, but not be able to access &lt;code class=&quot;language-text&quot;&gt;users&lt;/code&gt; at all. To do this, we will need three Istio resources.&lt;/p&gt;
&lt;p&gt;First, we need to enable authorization for the &lt;code class=&quot;language-text&quot;&gt;default&lt;/code&gt; Kubernetes namespace:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;rbac.istio.io/v1alpha1&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterRbacConfig
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;ON_WITH_INCLUSION&apos;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;inclusion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;namespaces&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;default&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Second, we‚Äôll define our &lt;code class=&quot;language-text&quot;&gt;ServiceRole&lt;/code&gt;, the abstract set of permissions to &lt;code class=&quot;language-text&quot;&gt;POST&lt;/code&gt; data to the &lt;code class=&quot;language-text&quot;&gt;shoes&lt;/code&gt; service:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;rbac.istio.io/v1alpha1&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceRole
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; shoes&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;user
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;shoes.default.svc.cluster.local&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;methods&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;POST&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Lastly, we‚Äôll bind this abstract &lt;code class=&quot;language-text&quot;&gt;shoes-user&lt;/code&gt; role to a concrete set of &lt;code class=&quot;language-text&quot;&gt;subjects&lt;/code&gt; ‚Äî in this case, any request that has the &lt;code class=&quot;language-text&quot;&gt;hello:world&lt;/code&gt; HTTP header.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;rbac.istio.io/v1alpha1&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceRoleBinding
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; shoes&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;binding
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      request.headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;hello&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;world&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceRole
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;shoes-user&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From here, the &lt;code class=&quot;language-text&quot;&gt;inventory&lt;/code&gt; service can only make requests to &lt;code class=&quot;language-text&quot;&gt;shoes&lt;/code&gt; with the &lt;code class=&quot;language-text&quot;&gt;hello:world&lt;/code&gt; header, and the &lt;code class=&quot;language-text&quot;&gt;users&lt;/code&gt; service is still locked down. This is because RBAC is on, but we haven‚Äôt assigned any &lt;code class=&quot;language-text&quot;&gt;ServiceRoles&lt;/code&gt; to access the &lt;code class=&quot;language-text&quot;&gt;users&lt;/code&gt; service.&lt;/p&gt;
&lt;p&gt;To learn more:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/tasks/security/authz-http/#step-2-allowing-access-to-the-details-and-reviews-services&quot;&gt;Istio Authorization with Pod service accounts&lt;/a&gt; (requires mutual TLS)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/blog/2018/istio-authorization/#using-authenticated-client-identities&quot;&gt;End-user authorization&lt;/a&gt; through JWT claims&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/tasks/security/authz-http/#enforcing-namespace-level-access-control&quot;&gt;Namespace-level authorization&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[traffic mirroring]]></title><description><![CDATA[Testing a service in production is important to help ensure reliability. Sending live production traffic to a new version of a service can‚Ä¶]]></description><link>https://istiobyexample.dev//traffic-mirroring/</link><guid isPermaLink="false">https://istiobyexample.dev//traffic-mirroring/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;Testing a service in production is important to help ensure reliability. Sending live production traffic to a new version of a service can help reveal bugs that went untested during continuous integration and functional tests.&lt;/p&gt;
&lt;p&gt;Using Istio, you can use &lt;a href=&quot;https://istio.io/docs/tasks/traffic-management/mirroring/&quot;&gt;&lt;strong&gt;traffic mirroring&lt;/strong&gt;&lt;/a&gt; to duplicate traffic to another service. You can incorporate a traffic mirroring rule as part of a &lt;a href=&quot;https://istiobyexample.dev/canary&quot;&gt;canary deployment&lt;/a&gt; pipeline, allowing you to analyze a service‚Äôs behavior before sending live traffic to it.&lt;/p&gt;
&lt;p&gt;In this example, we have deployed a video processing pipeline to Kubernetes. The &lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt; service has a dependency on the &lt;code class=&quot;language-text&quot;&gt;encode-prod&lt;/code&gt; service, and we want to roll out a new version of &lt;code class=&quot;language-text&quot;&gt;encode&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;encode-test&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/031ce1539dfa83454bce2201ea1bec7e/e95bd/mirror.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.19798234552333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABkklEQVQoz42S7XKbMBBF8/7P5kwmnTSO26a1E9uABUZfgIQEp7Jw0vZHmy5zZzTAHN29uzfzPPMvwUVczzBNkX42DFiGYHDBZoXJ5+83/LXm5XkHLxUJdKLG71rsJDG+5jwcUa5agHGaOciRUgVOJnC2gUaNSPdubnE2J1T0SF8iPq2ZNppy/0ThvtH0r7TuuAB7P7Ha9vwQnrUY0V/O2NuC41nTR4vyVXbQJmknKPtn6ocN8UEi9s+oKJK7U/4nA7sEvH8dkF1g2waGdc300vL9fo1wBb0zxHnM7WenqWljBV15wsSa1h9o3AtmrK8Ox4nbXc+hHdnUyeFOYe4qRJPabzXFsaCzHc75DB3H1LaV2NCjtaJtW6SUDMPwK8NKB0TKr0n5KTchh4hOzmNME+17lFJUVZUAOk3Wo75W+HWTLq3z+7IsaZrmoyn/Wd57rLVoozmvdkxbzXb1RNUItNIIIRbgR3v4+8pkcEixPBaEzw2nfZkvqOs667+Ab0v9dh7HtFIqZWgspjPIa4aXaC71E+R5BpF6VBozAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;traffic mirroring&quot;
        title=&quot;traffic mirroring&quot;
        src=&quot;/static/031ce1539dfa83454bce2201ea1bec7e/b9e4f/mirror.png&quot;
        srcset=&quot;/static/031ce1539dfa83454bce2201ea1bec7e/cf440/mirror.png 148w,
/static/031ce1539dfa83454bce2201ea1bec7e/d2d38/mirror.png 295w,
/static/031ce1539dfa83454bce2201ea1bec7e/b9e4f/mirror.png 590w,
/static/031ce1539dfa83454bce2201ea1bec7e/f9b6a/mirror.png 885w,
/static/031ce1539dfa83454bce2201ea1bec7e/2d849/mirror.png 1180w,
/static/031ce1539dfa83454bce2201ea1bec7e/e95bd/mirror.png 1586w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;We can use an Istio &lt;code class=&quot;language-text&quot;&gt;VirtualService&lt;/code&gt; to mirror all &lt;code class=&quot;language-text&quot;&gt;encode-prod&lt;/code&gt; traffic to &lt;code class=&quot;language-text&quot;&gt;encode-test&lt;/code&gt;. The client side Envoy proxy for &lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt; will then send requests to both &lt;code class=&quot;language-text&quot;&gt;encode-prod&lt;/code&gt; (request path) and &lt;code class=&quot;language-text&quot;&gt;encode-test&lt;/code&gt; (mirrored path). &lt;code class=&quot;language-text&quot;&gt;prod&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt; are two subsets of the &lt;code class=&quot;language-text&quot;&gt;encode&lt;/code&gt; Kubernetes service, specified in an Istio &lt;code class=&quot;language-text&quot;&gt;DestinationRule&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: &lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt; &lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#route-routeaction-requestmirrorpolicy&quot;&gt;will not wait&lt;/a&gt; to receive responses from &lt;code class=&quot;language-text&quot;&gt;encode-test&lt;/code&gt; ‚Äî mirrored requests are ‚Äúfire and forget.‚Äù&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; encode&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;mirror
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; encode
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; encode
        &lt;span class=&quot;token key atrule&quot;&gt;subset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; prod
      &lt;span class=&quot;token key atrule&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;mirror&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; encode
      &lt;span class=&quot;token key atrule&quot;&gt;subset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; test&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DestinationRule
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; encode
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; encode
  &lt;span class=&quot;token key atrule&quot;&gt;subsets&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; prod
    &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; prod
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; test
    &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; test&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[bring your own prometheus]]></title><description><![CDATA[Prometheus is an open-source monitoring tool. By default, Prometheus is installed alongside Istio, allowing you to use Grafana and Kiali to‚Ä¶]]></description><link>https://istiobyexample.dev//prometheus/</link><guid isPermaLink="false">https://istiobyexample.dev//prometheus/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://prometheus.io/docs/introduction/overview/&quot;&gt;Prometheus&lt;/a&gt; is an open-source monitoring tool. By default, Prometheus is installed alongside Istio, allowing you to use Grafana and Kiali to view metrics for both the Istio control plane and your Envoy-injected workloads.&lt;/p&gt;
&lt;p&gt;But what if you‚Äôre already running Prometheus on your cluster, or you want to add extra customization to Istio‚Äôs Prometheus installation (for instance, add &lt;a href=&quot;https://prometheus.io/docs/alerting/notification_examples/#customizing-slack-notifications&quot;&gt;Slack notifications&lt;/a&gt; for Istio )?&lt;/p&gt;
&lt;p&gt;Not to worry. You can bring your own Prometheus to Istio, with three quick steps.&lt;/p&gt;
&lt;p&gt;First, &lt;strong&gt;update your Prometheus configuration.&lt;/strong&gt; Prometheus relies on a &lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config&quot;&gt;scrape config model&lt;/a&gt;, where &lt;code class=&quot;language-text&quot;&gt;targets&lt;/code&gt; represent &lt;code class=&quot;language-text&quot;&gt;/metrics&lt;/code&gt; endpoints, ingested by the Prometheus server.&lt;/p&gt;
&lt;p&gt;We‚Äôll add &lt;code class=&quot;language-text&quot;&gt;targets&lt;/code&gt; for &lt;a href=&quot;https://istio.io/docs/tasks/telemetry/metrics/querying-metrics/&quot;&gt;each of the Istio components&lt;/a&gt;, which are scraped &lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config&quot;&gt;through the Kubernetes API server&lt;/a&gt;. For instance, here is the configuration for Istio‚Äôs &lt;a href=&quot;https://istio.io/docs/concepts/traffic-management/#pilot&quot;&gt;Pilot&lt;/a&gt; component:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;job_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pilot&apos;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;kubernetes_sd_configs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; endpoints
        &lt;span class=&quot;token key atrule&quot;&gt;namespaces&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;names&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; istio&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;system

      &lt;span class=&quot;token key atrule&quot;&gt;relabel_configs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;source_labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;__meta_kubernetes_service_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; __meta_kubernetes_endpoint_port_name&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; keep
        &lt;span class=&quot;token key atrule&quot;&gt;regex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; istio&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pilot;http&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;monitoring&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See &lt;a href=&quot;https://github.com/askmeegs/istiobyexample/blob/888a7b5c573c9ba6bf2c0e046e44bf4f8d8d2506/content/blog/prometheus/configmap.yaml&quot;&gt;configmap.yaml&lt;/a&gt; for a full example.&lt;/p&gt;
&lt;p&gt;Second, &lt;strong&gt;update your Prometheus deployment&lt;/strong&gt; to mount Istio‚Äôs certificates into Prometheus. This allows Prometheus to scrape Istio workloads when mutual TLS is enabled. To do this, mount in the &lt;code class=&quot;language-text&quot;&gt;istio.default&lt;/code&gt; secret into your Prometheus deployment YAML:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;    &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
        &lt;span class=&quot;token key atrule&quot;&gt;configMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; prometheus
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; istio&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;certs
        &lt;span class=&quot;token key atrule&quot;&gt;secret&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;defaultMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;420&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;optional&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;secretName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; istio.default&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See &lt;a href=&quot;https://github.com/askmeegs/istiobyexample/blob/888a7b5c573c9ba6bf2c0e046e44bf4f8d8d2506/content/blog/prometheus/deployment.yaml&quot;&gt;deployment.yaml&lt;/a&gt; for the full example.&lt;/p&gt;
&lt;p&gt;Once we deploy Prometheus with this new configuration, we have a Deployment and a Service running in a separate &lt;code class=&quot;language-text&quot;&gt;monitoring&lt;/code&gt; namespace:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ kubectl get &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; -n monitoring

NAME         TYPE           CLUSTER-IP   EXTERNAL-IP      PORT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;          AGE
prometheus   LoadBalancer   10.0.3.155   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;IP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;             9090:32352/TCP   21m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Lastly, &lt;strong&gt;update Istio‚Äôs configuration&lt;/strong&gt; to use a custom Prometheus address. Here‚Äôs a &lt;a href=&quot;https://istio.io/docs/setup/kubernetes/install/helm/&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;helm template&lt;/code&gt;&lt;/a&gt; example using the &lt;a href=&quot;https://istio.io/docs/reference/config/installation-options/#grafana-options&quot;&gt;Istio installation options&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;helm template install/kubernetes/helm/istio --name istio --namespace istio-system \
--set prometheus.enabled&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;false \
--set kiali.enabled&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true --set kiali.createDemoSecret&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true \
--set kiali.prometheusAddr&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http://prometheus.monitoring.svc.cluster.local:9090&quot;&lt;/span&gt; \
--set &lt;span class=&quot;token string&quot;&gt;&quot;kiali.dashboard.jaegerURL=http://jaeger-query:16686&quot;&lt;/span&gt; \
--set &lt;span class=&quot;token string&quot;&gt;&quot;kiali.dashboard.grafanaURL=http://grafana:3000&quot;&lt;/span&gt; \
--set grafana.enabled&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true \
--set grafana.datasources.datasources.datasources.url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http://prometheus.monitoring.svc.cluster.local:9090&quot;&lt;/span&gt;  &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; istio.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Once Istio and Prometheus are both installed, and we deploy some Istio-injected workloads to our cluster, we can see that Prometheus is successfully scraping our Istio targets:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6cd62a6d2ce9f4c89cd2b5ae76e96256/ec21f/prometheus.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.90424570912376%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACRElEQVQoz3VS227TQBD1j1Ek2oc0ohUSD0j8EH/BA08gwRvlqVxEHypEaUEEgtMEUqe2114ntuPrXuzDeN0bUlnpaGZ3zs7O7Bnr4aPHGO48wPD+Lra2d7E52MW9wQ7ubg1xZ3OAjc1tsrdj4wId73Jv/Zgv8eF7gCd7DPacIQwYPJ/BZ4GB6/lgZDt45Hv+NdyLPQvCK661TDKIFohr/LOqukZd94dFWSErKvxvxXGMsiyNb03cFIuoxCwoceqXKIqCghXCOAKPl1B1hfF5hr1Ribe2xLuJICtw7NSoKMk6y3B25oBzbpJaLAOivMUnp8Wz4xZNQ+WivXq9ba/9hvwu3B/1vBthw7WiKILWGlopOlJQUpr9Ml5hRa10l9wwgX2eIMgasFQRNLxEo6i1+RZnsQCnPIruWbZf4Q8XOHEEXo9q5GUNKQTiLEWSr9FIgVlYY99W+DjTOPitDN5PNVgiIOqSRAmQpmsIumd5icJaAE4C7E8BoS/Kb9ob7WpT/W2rYzRNY2BEcTyOtOgqIkVbgq7oJQmfMzAeElth7KywP0pwtNA4ciS+OAqHc4UgFSRMjrE9MSNlKjzlwJgpnC0VXnxVeDOWJolQElIr+luJuGwxXQKnXGMWNQSNCW+QFH28K0CRBpJgrbPcKNcVHxUtwqxvs6q6ORS9uoJmrC0utb5s1FhNreZ5Tvx+Ti2b2jmnOZyHJVZpAVHlZg5d7lPbAYlS4/MswdPDHC+/KYLEK8LzE4mDqUCerfFz/Auu65k5/AvFRmucRYOAHgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;prometheus&quot;
        title=&quot;prometheus&quot;
        src=&quot;/static/6cd62a6d2ce9f4c89cd2b5ae76e96256/b9e4f/prometheus.png&quot;
        srcset=&quot;/static/6cd62a6d2ce9f4c89cd2b5ae76e96256/cf440/prometheus.png 148w,
/static/6cd62a6d2ce9f4c89cd2b5ae76e96256/d2d38/prometheus.png 295w,
/static/6cd62a6d2ce9f4c89cd2b5ae76e96256/b9e4f/prometheus.png 590w,
/static/6cd62a6d2ce9f4c89cd2b5ae76e96256/f9b6a/prometheus.png 885w,
/static/6cd62a6d2ce9f4c89cd2b5ae76e96256/2d849/prometheus.png 1180w,
/static/6cd62a6d2ce9f4c89cd2b5ae76e96256/ec21f/prometheus.png 2214w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Grafana can fetch service-level metrics:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/66b70fe32ec5fd197a44cae778397d0c/a16be/grafana.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.17056856187291%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7ElEQVQoz2VS2W7bMBDUP8SyrfsixUuHHR+Ca8dNkxToS9HH/v+XTIeMCxTow2B3qeXuzFCRMQ5l1UBIBdlr9MogSXPE6y3WD4R8k/yHDeG/JUkGIXq0nUS0rQW2aYHtNsWGWG94mQ2FGVHYCbnQWK3WSDqFlPnTU4ykkciUQ6YdYvZuSMD3po1A5C9vieQRPQKDR2PMJU0rYIcJZhihjYVxI5QdoH3UFklWfPYTUfyQ5LGKN1j9U8e+XpFRkiLPM2QpY5YROXPGNAtx/beXiHJOL4sKiv5pbuvoQ8E6y0rUnYabDujNBKFHMnxG2fTIixpV3dE3BWvJmtIrvoNHVOtn1G7BeH7F9f0nzOGOZryhkgPE/AJ1/I7bj98BmrmYv9IChf35jOm8wE57PqQNjzmME6Kq34UBcnfHvLxDzjfWV5RiQKMPaOwCd/qG4fga8sYc+Vd0MNZw6Al2nqliQse/JM8rSs5LVOWnZA9Byd4Cf940LZx14VzKHoPjkroN0upWQvLVHSUbM6Dmec1+Sj6gHi6YljfcPn5RMiVNd1Rk2PYjGjXjfH3D5eUDrdoRExdJ7Bdv0wI9zEGuhxu8ZMkGd0E3XeE4TIwXenpB2VkEf80Jav4CtbuG3BPwkrUxmI5HDiRDMm+FDJL/AEbUHYdMvVeKAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;grafana&quot;
        title=&quot;grafana&quot;
        src=&quot;/static/66b70fe32ec5fd197a44cae778397d0c/b9e4f/grafana.png&quot;
        srcset=&quot;/static/66b70fe32ec5fd197a44cae778397d0c/cf440/grafana.png 148w,
/static/66b70fe32ec5fd197a44cae778397d0c/d2d38/grafana.png 295w,
/static/66b70fe32ec5fd197a44cae778397d0c/b9e4f/grafana.png 590w,
/static/66b70fe32ec5fd197a44cae778397d0c/f9b6a/grafana.png 885w,
/static/66b70fe32ec5fd197a44cae778397d0c/2d849/grafana.png 1180w,
/static/66b70fe32ec5fd197a44cae778397d0c/a16be/grafana.png 2392w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;And Kiali can display the service graph:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/14557765c931272eca374db6f58454fc/435fe/kiali.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.95078299776287%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhklEQVQ4y31UiZKDIAz1/39yZ3Z6basoqNz4NsFqqdVmzBghPF4uq05K1I1A23bQxoBlmqYPTSkd2qVWWo+4CQUfImKMsNYhhLDq4lgeZpt9WbcEKqUULpcrmqaBEAKn0zm/67om5g1dYLMyuNYahqJgoL7vMQxDBiwZV3jKsvD8wHa91FK2e9XWabG3Bxdhdsx0mtLufrXH4EjBDwF57xFT2meIAzlimKYX0AL6xvAbGIf2oOKcbrdcJGb2StHsI0SL3/MFXNxdhiv9OT4YZ3HvFUYzYjBDvsRSpfk9GtoTHa6N/B5yWRgX3bpunMG9/sPP+UyMBQZt4HxY2a6ARwVgsJwzskMMucIhUfM7R/bc5Az40Ta7yUeEj/6Z/Nn2BMospZJwztMlMQOXUa0MFXV+R4kNdFANGq3qMytLOdRWZyD+ZsY5FQTI41qm5y3ktpN4tIKcHIQcULeSwvN00EL2Hay3a2PzKBrD4xg/WuwwZE4ch8nhpinO7MjOM01VXn4i27H9B02Enj8gmDAdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;kiali&quot;
        title=&quot;kiali&quot;
        src=&quot;/static/14557765c931272eca374db6f58454fc/b9e4f/kiali.png&quot;
        srcset=&quot;/static/14557765c931272eca374db6f58454fc/cf440/kiali.png 148w,
/static/14557765c931272eca374db6f58454fc/d2d38/kiali.png 295w,
/static/14557765c931272eca374db6f58454fc/b9e4f/kiali.png 590w,
/static/14557765c931272eca374db6f58454fc/f9b6a/kiali.png 885w,
/static/14557765c931272eca374db6f58454fc/2d849/kiali.png 1180w,
/static/14557765c931272eca374db6f58454fc/435fe/kiali.png 1788w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[modify response headers]]></title><description><![CDATA[With Istio, you can apply traffic rules to route based on HTTP request headers. You can also use Istio to modify response headers. This‚Ä¶]]></description><link>https://istiobyexample.dev//response-headers/</link><guid isPermaLink="false">https://istiobyexample.dev//response-headers/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;With Istio, you can apply traffic rules to route based on &lt;a href=&quot;https://istio.io/docs/tasks/traffic-management/request-routing/#route-based-on-user-identity&quot;&gt;HTTP request headers&lt;/a&gt;. You can also use Istio to &lt;a href=&quot;https://istio.io/docs/reference/config/networking/v1alpha3/virtual-service/#Headers&quot;&gt;modify response headers&lt;/a&gt;. This could be useful if you want to strip headers generated by your application, or if you want to add response headers without changing your application code.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c8d7b3515f03624b7f7daeac033d0d40/83aca/headers.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.9443103170771%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAJnKAACZygHjkaQiAAABJklEQVQoz3WSYU+DMBiE9///0RI/7ZOJiTE6F50CZkPQwdiAtkBb+ghkm+K2Sy6XvHl7ucvbiXOOHr2ekyt6mT0mR7P/+J25A4ch55vjN5O/Ceu6xlp7MrOtO1HqTvuxtshCo4RB5g3lrh7UNHacUEqJ1po8zxFliawNd7FjnjhuI8ds5fD3sIgM4rOgiguyb0WRViSrEtEZnwyNMUM6IQRBEKCURCjFawaPKbzv4GEDT50++wrlb1HLhOB+Q+TlrBcZZVaPE/aGVVUN5lrXFKpl6kVMgzmz2ONmteQlFoRxTbPeobyUzUeB2Dd8+Tnl9mB46SBHtJuQJnzDlAkmCWGf0kg91JRdxb5yGgq2kaQSepzw2jcYXfGwa007sLUdu4O19nf/B44MbpvBqBg2AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;headers&quot;
        title=&quot;headers&quot;
        src=&quot;/static/c8d7b3515f03624b7f7daeac033d0d40/b9e4f/headers.png&quot;
        srcset=&quot;/static/c8d7b3515f03624b7f7daeac033d0d40/cf440/headers.png 148w,
/static/c8d7b3515f03624b7f7daeac033d0d40/d2d38/headers.png 295w,
/static/c8d7b3515f03624b7f7daeac033d0d40/b9e4f/headers.png 590w,
/static/c8d7b3515f03624b7f7daeac033d0d40/f9b6a/headers.png 885w,
/static/c8d7b3515f03624b7f7daeac033d0d40/2d849/headers.png 1180w,
/static/c8d7b3515f03624b7f7daeac033d0d40/83aca/headers.png 6213w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In this example, we will apply an Istio &lt;a href=&quot;https://istio.io/docs/concepts/traffic-management/#virtual-services&quot;&gt;VirtualService&lt;/a&gt; to add a new header (&lt;code class=&quot;language-text&quot;&gt;hello:world&lt;/code&gt;), then remove the &lt;code class=&quot;language-text&quot;&gt;set-cookie&lt;/code&gt; header. Then, all client requests entering the service mesh through the &lt;code class=&quot;language-text&quot;&gt;default&lt;/code&gt; gateway will receive those modified headers.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; frontend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;gateways&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; frontend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;gateway
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; frontend
        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; world
          &lt;span class=&quot;token key atrule&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;set-cookie&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Before we apply the VirtualService, the &lt;code class=&quot;language-text&quot;&gt;frontend&lt;/code&gt; service returns the following response headers:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;HTTP/1.1 200 OK
set-cookie: shop_session-id=432bef95-0d25-4754-80c8-3904c2e329e9; Max-Age=172800
date: Wed, 18 Sep 2019 16:26:01 GMT
content-type: text/html; charset=utf-8
x-envoy-upstream-service-time: 45
server: istio-envoy
transfer-encoding: chunked&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then when we &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt; the VirtualService, we see that Envoy is successfully configured to modify the response headers:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;HTTP/1.1 200 OK
date: Wed, 18 Sep 2019 16:26:24 GMT
content-type: text/html; charset=utf-8
x-envoy-upstream-service-time: 85
hello: world
server: istio-envoy
transfer-encoding: chunked&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[locality load balancing]]></title><description><![CDATA[If you‚Äôre running a high-scale, global application, you might be running services in multiple regions. If you have multiple replicas of the‚Ä¶]]></description><link>https://istiobyexample.dev//locality-load-balancing/</link><guid isPermaLink="false">https://istiobyexample.dev//locality-load-balancing/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;If you‚Äôre running a high-scale, global application, you might be running services in multiple regions. If you have multiple replicas of the same service, you may want to direct client requests to the closest server, in order to minimize latency. You might also want a way to handle failover if one region goes down, and direct traffic to the closest available service.&lt;/p&gt;
&lt;p&gt;Istio can help you automatically handle regional traffic using a feature called &lt;strong&gt;locality load balancing.&lt;/strong&gt; Let‚Äôs see how.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ecbb11b64aa2ac2aa426660e3a034bbb/4072e/default.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 81.34368308351178%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAFxGAABcRgEUlENBAAACa0lEQVQ4y32UCW/aQBCF+f//K5XaSOmVhMMlEDD4wvba4HPt/TqLIThRWtAyaD3z5r05PDGG/37MyMH8w3l8P7E/XWfIc8PpZHB3hs3GMJubN0drrzFxbAgCw35veH21MbzzEUBx8OHpNywd+P4Azhy+foFDBFoPSH1vzscmW68Ny+Vgj0dz9rkmnOgWvEON6lMOTYLqFAmZfFPiY4VKz/nPgZZZUQxKrLXH3ruuEZUXwF4LszjkVb+wb/d4vUe9OJD7AZFWHNUNsGk+r3OWcQM0Arg4eDxU98zaOYvomW6qOM09giQSoBtgWZrz/6Fe1xob0tR8BPRZtgs27ZZduYXHnHLqExUpeXauILkFrG6A4+6m6YhhJzV0k5yNXuE2WxbCcnNaE9Qiv44vkqEUpm017uhHhgP4pG0NSl0ySUPui2/cFXf8rH+wKlycRJgaj6XyWB335+bd5m+wqWIMaCkPfGflE3+qGdPmF77eiOSERPV01MR5w7FsibWPU02lCjZGn08a64tkI4Byp/xYUB10vICTR+W4EAV0ojPLBhZ2gOuih8ShtX75Cu16dBthHcbotr8wFGTlyQQnMs1lRBfuqKcZzSKgTmQu82uXoSolKJQNyFxMsqWeRTRzmdelxPVjwH0oazHFFAF9tKN6UjTPMo9J+gngI6ZMMKkknoU004R4HowARXIWSqHzpch+AWlEH1rGHrrML5IHwLqy2Z3B77gWUPHzfYkfS5amRNGwj3UNTS0bIQ9boW6HWVS/AWaZwU5F3Vz8mg7d9URhf2uKXXg7mJaJDRjscOz9sB3DS0Ip3j0fn+uQ/wX/BNYXcPkE6wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;default&quot;
        title=&quot;default&quot;
        src=&quot;/static/ecbb11b64aa2ac2aa426660e3a034bbb/b9e4f/default.png&quot;
        srcset=&quot;/static/ecbb11b64aa2ac2aa426660e3a034bbb/cf440/default.png 148w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/d2d38/default.png 295w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/b9e4f/default.png 590w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/f9b6a/default.png 885w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/2d849/default.png 1180w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/4072e/default.png 3736w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Here, we have two Kubernetes clusters running in two different cloud regions, &lt;code class=&quot;language-text&quot;&gt;us-central&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;us-east&lt;/code&gt;.
The Istio control plane is running in &lt;code class=&quot;language-text&quot;&gt;us-east&lt;/code&gt;, and we have set up &lt;a href=&quot;https://github.com/GoogleCloudPlatform/istio-samples/tree/191859c03e73da7e98d451c967cefe24101d1933/multicluster-gke/single-control-plane#demo-multicluster-istio--single-control-plane&quot;&gt;single control plane&lt;/a&gt; Istio multicluster, so that services running in both clusters can reach each other.&lt;/p&gt;
&lt;p&gt;When we started both clusters, the cloud provider added region-specific &lt;code class=&quot;language-text&quot;&gt;failure-domain&lt;/code&gt; labels to the Kubernetes nodes:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;failure-domain.beta.kubernetes.io/region: us-central1
failure-domain.beta.kubernetes.io/zone: us-central1-b&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Istio will populate requests with these locality labels, allowing Istio to redirect requests to the closest available region.&lt;/p&gt;
&lt;p&gt;Both clusters are running an Istio-injected service called &lt;code class=&quot;language-text&quot;&gt;echo&lt;/code&gt;, which prints its location when accessed on port &lt;code class=&quot;language-text&quot;&gt;80&lt;/code&gt;. The central cluster is also running a &lt;code class=&quot;language-text&quot;&gt;loadgen&lt;/code&gt; service that calls &lt;code class=&quot;language-text&quot;&gt;echo.default.svc.cluster.local:80&lt;/code&gt; every second.&lt;/p&gt;
&lt;p&gt;By default, the Kubernetes Service behavior is round-robin, between the two &lt;code class=&quot;language-text&quot;&gt;echo&lt;/code&gt; servers on both clusters:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ üåä Hello World! - EAST
$ ‚ú® Hello World! - CENTRAL
$ üåä Hello World! - EAST
$ ‚ú® Hello World! - CENTRAL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can enable locality load balancing by adding an &lt;a href=&quot;https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#OutlierDetection&quot;&gt;outlier detection&lt;/a&gt; Istio DestinationRule on the &lt;code class=&quot;language-text&quot;&gt;east&lt;/code&gt; cluster:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DestinationRule
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;outlier&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;detection
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo.default.svc.cluster.local
  &lt;span class=&quot;token key atrule&quot;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;connectionPool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;tcp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;maxConnections&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;http2MaxRequests&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;maxRequestsPerConnection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;outlierDetection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;consecutiveErrors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;interval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 30s
      &lt;span class=&quot;token key atrule&quot;&gt;baseEjectionTime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 30s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, all &lt;code class=&quot;language-text&quot;&gt;loadgen&lt;/code&gt; requests are routed to the closest instance of &lt;code class=&quot;language-text&quot;&gt;echo&lt;/code&gt;, running in &lt;code class=&quot;language-text&quot;&gt;us-central&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ ‚ú® Hello World! - CENTRAL
$ ‚ú® Hello World! - CENTRAL
$ ‚ú® Hello World! - CENTRAL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/938519d153fa72945f4be94f2a0f96ec/7570e/locality.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 84.3732590529248%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAFxGAABcRgEUlENBAAACf0lEQVQ4y32UC2/aQBCE8///V6q2Uqo0TQIFlKhgDPh1Z+MXtm+/rm0caNoU6biVb252dnbtGxHhf7/r8zGWf2Im3E3/V1VCkghpJixXwuurcHcntK38dSHLwPOEzUaYz2WIr4lvnNPDNTz9gNUCvt/DyxK+fAJ/C3U9kTIkCENhvR6JVpr8cJABMyW/sQZMWWJdQtIaUmcxWFIS4rzAJAMdTQO7nVAUl1WWQp5rZakQBIJzSni0sK32rE4L/GaL73zqRUy63RO0CZkZCU8n9OLHXlvl6TotOddgXfh8Lm55bB5ZRTNklnGc++zjYPBsIjRmbMrk6cVbGc66jpFwU/r8rJ/xWo9tvkEeLPmDR5DFZOmFsFcx+TntU2wMI2Ff8q4Mea5VXb1k2Sy12zFRvmdbBxzfSpYz4VnVRwr7ptSNG7IUrmRez/nVrXlungYrjvZKoTl3fBqTq3hUqB72QXNSQnHMy0fujp/5mt8yq74riXtTdVHokK7VrdNdW08fNxeFRj1qMovkvpb6glQRVbKHPKIpUswfCjVxFSJFrCvU0hJcHA27CY50biK0AQQ62amHJB7Vt4RmEQyJTPqO0CyR+EVfmTWd71F8DWk3CTZMrxQaVXR4QDRTt/N0DlNOTzqPuxB7fE+4wJmNGpZRPyxpDjX1Dx/jm4vCkzlANEd6hbqqmZa78mm0xW8lq10m6QlXyHGPZBtcsqW839N6ATawZ4X9hFeF+qBll0HPrvdVltjhub320GpPnU56eRixbTpinXod1bTD2CgoihWsuF5tn6DvvNU4VN+jaByM/uUPgvG5Sa+wuhLFx8n5a9PPZdPIh8u5y+T1c/YxbsT8BrhLJFDfRuQGAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;locality&quot;
        title=&quot;locality&quot;
        src=&quot;/static/938519d153fa72945f4be94f2a0f96ec/b9e4f/locality.png&quot;
        srcset=&quot;/static/938519d153fa72945f4be94f2a0f96ec/cf440/locality.png 148w,
/static/938519d153fa72945f4be94f2a0f96ec/d2d38/locality.png 295w,
/static/938519d153fa72945f4be94f2a0f96ec/b9e4f/locality.png 590w,
/static/938519d153fa72945f4be94f2a0f96ec/f9b6a/locality.png 885w,
/static/938519d153fa72945f4be94f2a0f96ec/2d849/locality.png 1180w,
/static/938519d153fa72945f4be94f2a0f96ec/7570e/locality.png 3590w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If we delete the &lt;code class=&quot;language-text&quot;&gt;echo&lt;/code&gt; Deployment running in &lt;code class=&quot;language-text&quot;&gt;us-central&lt;/code&gt;, Istio will redirect &lt;code class=&quot;language-text&quot;&gt;loadgen&lt;/code&gt; requests to the &lt;code class=&quot;language-text&quot;&gt;echo&lt;/code&gt; Pod running in &lt;code class=&quot;language-text&quot;&gt;us-east&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ üåä Hello World! - EAST
$ üåä Hello World! - EAST
$ üåä Hello World! - EAST&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f926ea8027cb05d1c3bece596305f312/caaa1/failover.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 81.25171561899533%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAFxGAABcRgEUlENBAAACdklEQVQ4y3VUaXPbIBT0//9bmem3NI3bRPERy3V0WhfoRqC3fUh2ZKcTNAgEy/KWfWhFRPiu2Knr9Nynb3DL+Mq++p4gBEGWhP2e4LwRDgcLopsFcz8MCWnKGIdwPBKMWTAWthpHgvcBbF4Bdw+sn4DdG/DMbZ4DwzAv0JpQVcD7O8H3CS8vM2HJQbQtfUa5kgIougaxCRGoAIJyCEh+ChR1Dztvo7PkVWUjApTC1A6DVQecz0ukq1oCfhdhpzYIdcCkPrp1jCpLkWiB8kJYFDPJLP22go/LKsBC+NGG+NU+wjUuTtEeoyNRb0OcywylXAitbNu/mnX1oijoMnch9NoIT90jHPWKoPb4IEt0LkfYCdQXwpwXDZ+EdOfuHaGVlPUSsQ4hWOJ22OBv7bLcGHGfIy2GCWhxpJd8IqJP92fCeeOVTRd1cdIbPPxofuChecC6X+PYeNhnMRIKsU1DfHQBirG4y9MpQoElwulAew0zlHirfsJvtjgwWdhtULY1Kmn3VYjzHj3bmvQnHBrOMa1AY8uTNYpUQZtrhCXbL1O26h2m5IRsMiiHv6sGuq2m3W2x6WOahsNxoeWJcQGUm2D0I4hEfiEUZ74CnMl9Bn08otsIqG0ExeGJyZRxllXzK3rmzUKM0Qm9c8bgRMhPOWbFt4SJAxokjO+h/V1g2J2hyhtCbnVlHdyyVIUx43z9w5g1n6tXQI83hLriayB2LOcAcAqNKUtuEuiuvhDSFKHpO8bx/RSMq08gkfH9DL5IZmDT0HRnleLaj+y64W+Dup4T+prY9s7e4ZRhdw3/LMaF0AIsqZT/VztuF9vyHc6O2Z/GNcn/AbYp1e8nLXMJAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;failover&quot;
        title=&quot;failover&quot;
        src=&quot;/static/f926ea8027cb05d1c3bece596305f312/b9e4f/failover.png&quot;
        srcset=&quot;/static/f926ea8027cb05d1c3bece596305f312/cf440/failover.png 148w,
/static/f926ea8027cb05d1c3bece596305f312/d2d38/failover.png 295w,
/static/f926ea8027cb05d1c3bece596305f312/b9e4f/failover.png 590w,
/static/f926ea8027cb05d1c3bece596305f312/f9b6a/failover.png 885w,
/static/f926ea8027cb05d1c3bece596305f312/2d849/failover.png 1180w,
/static/f926ea8027cb05d1c3bece596305f312/caaa1/failover.png 3643w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;We can also add a percentage-based load balancing rule for mesh-wide traffic, in the global Istio installation settings:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;    localityLbSetting:
      distribute:
      - from: us-central1/*
        to:
          us-central1/*: 20
          us-east1/*: 80&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, all services running in both clusters will share requests 80/20, between &lt;code class=&quot;language-text&quot;&gt;us-east&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;us-central&lt;/code&gt;. No VirtualServices are needed.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ üåä Hello World! - EAST
$ üåä Hello World! - EAST
$ üåä Hello World! - EAST
$ üåä Hello World! - EAST
$ ‚ú® Hello World! - CENTRAL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a1ecb7dd29b7381cae395f758e69f395/dd1f1/splittraffic.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 84.5488613433266%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAFxGAABcRgEUlENBAAACsElEQVQ4y31Ui1biMBTk/79rPe5DxYUFAUGFQimPJn2mSR+ZnbSg4DkK5zahuZ3OnTuXnrUW330uz79LPef13EUVFqGwSBKL+aKLft9CKfuefH7ArQueR5HFYNDti+LjrNc0Fss3YDQEFnPg8QF4eQZ+3wKrJaC1fWdW10CeW0ynHeBoZOF5tr1XVYDD6kkBhJmCrCIIEyPierQRQn5jk+F4AMrKIVoEgcXxyIoUEMfdmqbd/nCwXAmYRsCmCDAvp1iXHrYIYJYS8XoHBxtJApYdoJRnHe2nQMswIlYv4+Ut36Cv7rCslpiLCeqRRDrcQuZ7yPgDUAhXWrd3wJ22nRxaXwAuCfhb/cTYjPEm57DjGOmjD5EG14CSgHXDXXPVpCtAV7KnAszMBEG5xaJaINrtIDcEg0BMjeuqYxGzZGKdfPIFQ6dRbgzC+sCy7/FX9TGtJpjXcwT1BoEokBiFEhqrMMaP5AZL80qgphW0Y2hbN7jO95zQmiU9k9mNukVmi/aNpqlR8Ds7Bm3TDvUOk6OPX9kd7vXDJdGOoTkxlLyUWcL+b+ALJir6RFM4zTdVGRKe21PJTh735Er+QZl49E0IS6uBVjNMjKRj6EQXW4DNQLJrgYvBHvppTfGoYmubphVPELCKA0C8Mo9r5kGPfZjxDialxUR1Agw3QPCIptij3qygFwmKfz5sSNukFz4kYJ3sYbd9WFZQ+wR82qLyMuSzNeKkOTP0+VbaRUew0ocaSKg7MlTiyjYtoGMoX2CbkrmsZhhAD0MoNwhR3QFWCedJTgk6Y8vJNmOdUdCW3Gp8Adjk9JHksAtGtmLwd3xAmR5ZMhmGIe+ltn2I7oEpGhhd0QYVStNwRj8A2znOXd4pdJdbljVSltt22f1FCdG1/HM4Rm7gz+bNsq9zXbix/A/aIh+xtESi/gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;split&quot;
        title=&quot;split&quot;
        src=&quot;/static/a1ecb7dd29b7381cae395f758e69f395/b9e4f/splittraffic.png&quot;
        srcset=&quot;/static/a1ecb7dd29b7381cae395f758e69f395/cf440/splittraffic.png 148w,
/static/a1ecb7dd29b7381cae395f758e69f395/d2d38/splittraffic.png 295w,
/static/a1ecb7dd29b7381cae395f758e69f395/b9e4f/splittraffic.png 590w,
/static/a1ecb7dd29b7381cae395f758e69f395/f9b6a/splittraffic.png 885w,
/static/a1ecb7dd29b7381cae395f758e69f395/2d849/splittraffic.png 1180w,
/static/a1ecb7dd29b7381cae395f758e69f395/dd1f1/splittraffic.png 3469w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;To learn more about Locality-based load balancing with Istio, see the &lt;a href=&quot;https://istio.io/docs/ops/traffic-management/locality-load-balancing/&quot;&gt;Istio documentation&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[virtual machines]]></title><description><![CDATA[Running containerized services in Kubernetes can add lots of benefits, including autoscaling, dependency isolation, and resource‚Ä¶]]></description><link>https://istiobyexample.dev//virtual-machines/</link><guid isPermaLink="false">https://istiobyexample.dev//virtual-machines/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;Running containerized services in Kubernetes can add lots of benefits, including autoscaling, dependency isolation, and resource optimization. Adding Istio to your Kubernetes environment can radically simplify metrics aggregation and policy management, even if you‚Äôre operating lots of containers.&lt;/p&gt;
&lt;p&gt;But what about stateful services, or legacy applications are running in virtual machines? Or what if you‚Äôre migrating from VMs to containers? Have no fear: you can integrate virtual machines into your Istio service mesh. Let‚Äôs see how.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5aa6be26035def23daebd8254eb4399b/76ebb/call-flow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.20622041920217%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAFxGAABcRgEUlENBAAABlElEQVQoz5WTX3PSQBTF86n9Fn4Vnxyf1AdFHa3FEQqB0kL+GPKfkCwhDdnNzw20Cm1nxDtz5t59yNk9554YbdvyL3T1eH7o6gjd2eCMenKJ+kv+uIwwK/HTDV4i9j1al4SiItpU/IrF/uYT8qP5rpFMkpxZWjDVPRBbjImTYmq4ccHEXZGVNcUnl3Ka4OVbpFRIpWikZKc7smXz0YG8JpcNg2CFr4luVgXDMMMYWQnDRYxpp/ywYsbfHBozoRnHzH4u6ZlL3vVtTCvn6yzi9sOCnZNTffcxvRVf3IjrNKfnhAweCD+PPG69jEtN/P71mNpa0/iCCz0vsi3jucvLVy8Y2HOu3twgxR1brWJoJ3u5oban0vIXmcCYapmd1FTLm2nSoqhoLn12/YBY+3soxZX9lloKaED0HNqlQChJf5ky10SjKNNYY3TGW0GOFeY4YYGvSYJ72FGhvVMnSzk+Kb3tzj+vKLHWgk3dYHTrPxjfHsxv1J5kp3v3wZ+86dc8l88nsTkng88G+4j4JNj/86ecU78BmApPCp+f/YoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;call flow&quot;
        title=&quot;call flow&quot;
        src=&quot;/static/5aa6be26035def23daebd8254eb4399b/b9e4f/call-flow.png&quot;
        srcset=&quot;/static/5aa6be26035def23daebd8254eb4399b/cf440/call-flow.png 148w,
/static/5aa6be26035def23daebd8254eb4399b/d2d38/call-flow.png 295w,
/static/5aa6be26035def23daebd8254eb4399b/b9e4f/call-flow.png 590w,
/static/5aa6be26035def23daebd8254eb4399b/f9b6a/call-flow.png 885w,
/static/5aa6be26035def23daebd8254eb4399b/2d849/call-flow.png 1180w,
/static/5aa6be26035def23daebd8254eb4399b/76ebb/call-flow.png 2958w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In this example, we are running a web application for a local library. This web app has multiple backends, all running in a Kubernetes cluster. One of our Kubernetes workloads, &lt;code class=&quot;language-text&quot;&gt;inventory&lt;/code&gt;, talks to a PostgreSQL database, and writes a record for each new book added to the library. This database is running in a virtual machine in another cloud region.&lt;/p&gt;
&lt;p&gt;In order to get the full Istio functionality for PostgreSQL, our VM-based database, we need to install the Istio sidecar proxy on the VM, and configure it to talk to the Istio control plane running in the cluster. (Note that this is different from adding external &lt;a href=&quot;/external-services&quot;&gt;ServiceEntries&lt;/a&gt;.) We can add our Postgres database to the mesh with three steps. You can follow along with the commands in the &lt;a href=&quot;https://github.com/askmeegs/postgres-library/tree/0241acce9d7e2cede0de8ac9baa1338624f716eb#-postgres-library&quot;&gt;demo on GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3f551cc3dee50629373db7558e62170c/efc60/architecture.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.55693805788477%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAFxGAABcRgEUlENBAAACFElEQVQoz1WTSZObMBCF/evnjyT3OeeUyjFVs+927PGKWY1AIGQM0pfGrokdqpqGlvT6ve7WCDzGePZ7z/nxF/707f3XS1zf4juLd534Bt9W/06MlPJcXXmurz07+Y5SSDJPvvOUBZQSa9sT8IB3PJyPcdkrXq9wyTMufsSbTBIdGB0Onu/f4MdPT1B5Eu1ZK6hbeIk9byHo8szdNRmm1lhrsU1D3xt6V9LvY0mmGQ2bagGJ5NB9AoUA2c4R5yX6U7Ec79iEFY2pqOuGPFqyWi5IkphNEKOKDxr7wMGujuxHg5RCGCXC7jFxrEvPQvWk2tJOUvRUkcm/Ezld79jr5AiYS8K6UnTtO66b49rgDDjUKtxZVmnFPDH8Sa3ELLtSGBUHkXbRr14LWE7nZL1eCoGStSSvjEg81CfASsNsU/IyT/kMC6K4xN1GVItckjQ8jRX30w/iomFf5ei7Nd12ykzAPlLNbZgTqBw6cwacCuBsq9gWhrubFZ3UL3/Y8j7JGS81N5NfxFXD5nWOfoswLwm/JyGLQlSpmp0Wmd0lw6DkfZWxEHaLUGGfY4pZRla2WHMh2ciagHXLik8BWpVSImWkqReAA9swaVnHhk3cSIf3xKolUuLTDqWOxcPJHDqb4WTmOJTS+R1BuiXIIhodfdWQ4y0ZEtQVR7bD3A1WiRUS/2+wvRPr5Zb0w5UZJvNkQ0w2/AVo6klzRTj/SAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;architecture&quot;
        title=&quot;architecture&quot;
        src=&quot;/static/3f551cc3dee50629373db7558e62170c/b9e4f/architecture.png&quot;
        srcset=&quot;/static/3f551cc3dee50629373db7558e62170c/cf440/architecture.png 148w,
/static/3f551cc3dee50629373db7558e62170c/d2d38/architecture.png 295w,
/static/3f551cc3dee50629373db7558e62170c/b9e4f/architecture.png 590w,
/static/3f551cc3dee50629373db7558e62170c/f9b6a/architecture.png 885w,
/static/3f551cc3dee50629373db7558e62170c/2d849/architecture.png 1180w,
/static/3f551cc3dee50629373db7558e62170c/efc60/architecture.png 3697w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/askmeegs/postgres-library#5-allow-pod-ip-traffic-to-the-vm&quot;&gt;Create a firewall rule&lt;/a&gt; for pod-to-VM traffic&lt;/strong&gt;. This allows traffic from the Kubernetes pod CIDR range directly into our VM-based workload.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/askmeegs/postgres-library#6-prepare-a-clusterenv-file-to-send-to-the-vm&quot;&gt;Install Istio&lt;/a&gt; on the VM&lt;/strong&gt;. Copy the service account keys, and the ports the VM service exposes (in this case, PostgreSQL client port &lt;code class=&quot;language-text&quot;&gt;5432&lt;/code&gt;). Update the &lt;code class=&quot;language-text&quot;&gt;/etc/hosts&lt;/code&gt; on the VM to route &lt;code class=&quot;language-text&quot;&gt;istio.pilot&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;istio.citadel&lt;/code&gt; traffic through the Istio IngressGateway running on the cluster. Then, install the Istio sidecar proxy and node agent on the VM. The node agent is responsible for generating client certificates to mount into the sidecar proxy, for mutual TLS authentication. Start the proxy and node agent using &lt;code class=&quot;language-text&quot;&gt;systemctl&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/askmeegs/postgres-library#8-register-the-vm-with-istio-running-on-the-gke-cluster&quot;&gt;Register the VM&lt;/a&gt; workload with Kubernetes&lt;/strong&gt;. We need two Kubernetes resources to add our Postgres database to the mesh. The first is a &lt;code class=&quot;language-text&quot;&gt;ServiceEntry&lt;/code&gt;. This will route the Kubernetes DNS name to the virtual machine IP address. Finally, we need a Kubernetes &lt;code class=&quot;language-text&quot;&gt;Service&lt;/code&gt; to create that DNS entry. This is what will allow our client pod to &lt;a href=&quot;https://github.com/askmeegs/postgres-library/blob/master/main.go#L39&quot;&gt;start a database connection&lt;/a&gt; at &lt;code class=&quot;language-text&quot;&gt;postgres-1-vm.default.svc.cluster.local&lt;/code&gt;. We can use the &lt;code class=&quot;language-text&quot;&gt;istioctl register&lt;/code&gt; command to do this.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We can now verify that the Kubernetes-based client can successfully write to the database, by viewing the pod logs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;postgres-library-6bb956f86b-dt94x server ‚úÖ inserted Fun Home
postgres-library-6bb956f86b-dt94x server ‚úÖ inserted Infinite Jest
postgres-library-6bb956f86b-dt94x server ‚úÖ inserted To the Lighthouse&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And we can verify that the sidecar proxy running on the VM is intercepting inbound traffic on port &lt;code class=&quot;language-text&quot;&gt;5432&lt;/code&gt;, by viewing the Envoy access logs on the VM.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ tail /var/log/istio/istio.log

[2019-11-14T19:09:00.174Z] &amp;quot;- - -&amp;quot; 0 - &amp;quot;-&amp;quot; &amp;quot;-&amp;quot; 268 441 194 - &amp;quot;-&amp;quot; &amp;quot;-&amp;quot; &amp;quot;-&amp;quot; &amp;quot;-&amp;quot;
&amp;quot;127.0.0.1:5432&amp;quot; inbound|5432|tcp|postgresql-1-vm.default.svc.cluster.local
127.0.0.1:54104 10.128.0.14:5432 10.24.2.23:40190
outbound_.5432_._.postgresql-1-vm.default.svc.cluster.local -&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can also see TCP metrics flowing in the Kiali service graph:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cfd71c3c1d641f6486d87cdbfb40c7b8/1589a/kiali.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.86520376175549%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAuUlEQVQoz61S0Q6CMAzk/z/JT/AVlwWToTi3lylmxhAIjJMOMZOMwINNbm2663Jtl+DPlkxB3/dfH8ahLXFCXhIm54gVO+cGxHn+wbmKmKKY2iWeV1jXNTjnyLIMQggcBy+l9ISu6zzITnmO9MDAGMOlKKCUgrX2VyEd1EbTNKiqCveyhDYjbvYFeVVQWsM8njClxW6fgoszXNuiHUC1qy1TikDkaU5j/Llba3k+4C22uJTYd9iK2LLedxPE51JRirYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;kiali&quot;
        title=&quot;kiali&quot;
        src=&quot;/static/cfd71c3c1d641f6486d87cdbfb40c7b8/b9e4f/kiali.png&quot;
        srcset=&quot;/static/cfd71c3c1d641f6486d87cdbfb40c7b8/cf440/kiali.png 148w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/d2d38/kiali.png 295w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/b9e4f/kiali.png 590w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/f9b6a/kiali.png 885w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/2d849/kiali.png 1180w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/1589a/kiali.png 1276w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;From here, we can use any Istio traffic or security policies to our multi-environment service mesh. For instance, we can encrypt all traffic between the cluster and the VM, by adding a mesh-wide mutual TLS policy:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;authentication.istio.io/v1alpha1&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;MeshPolicy&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;default&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;peers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;mtls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;networking.istio.io/v1alpha3&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;DestinationRule&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;default&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;istio-system&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*.local&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;tls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ISTIO_MUTUAL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To learn more:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/askmeegs/postgres-library&quot;&gt;Run this example in your environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/GoogleCloudPlatform/istio-samples/tree/master/mesh-expansion-gce&quot;&gt;Try another example&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/examples/virtual-machines/single-network/&quot;&gt;See the Istio documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[secure ingress]]></title><description><![CDATA[If you‚Äôre running workloads in a Kubernetes cluster, it‚Äôs likely that some need to be exposed outside of the cluster. The Istio Ingress‚Ä¶]]></description><link>https://istiobyexample.dev//secure-ingress/</link><guid isPermaLink="false">https://istiobyexample.dev//secure-ingress/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;If you‚Äôre running workloads in a Kubernetes cluster, it‚Äôs likely that some need to be exposed outside of the cluster. The &lt;a href=&quot;/ingress&quot;&gt;Istio Ingress Gateway&lt;/a&gt; is a customizable proxy that can route inbound traffic for one or many backend hosts. But what about securing ingress traffic with HTTPS?&lt;/p&gt;
&lt;p&gt;Istio supports TLS ingress by mounting certs and keys into the Ingress Gateway, allowing you to securely route inbound traffic to your in-cluster Services. When you set up secure ingress with Istio, the Ingress Gateway handles all TLS operations (handshake, certs/keys exchange), allowing you to decouple TLS from your application code. Further, using the Ingress Gateway for TLS traffic allows you to centralize and automate the management of certs and keys across your organization.&lt;/p&gt;
&lt;p&gt;Istio supports securing the Ingress Gateway through two methods. The first is through &lt;a href=&quot;https://istio.io/docs/tasks/traffic-management/ingress/secure-ingress-mount/&quot;&gt;file mount&lt;/a&gt;, where you generate certs and keys for the IngressGateway, then mount them manually into the IngressGateway as a Kubernetes Secret. The second way is through the &lt;a href=&quot;https://istio.io/docs/tasks/traffic-management/ingress/secure-ingress-sds/&quot;&gt;Secrets Discovery Service&lt;/a&gt; (SDS), an agent that runs in the IngressGateway pod, alongside the Istio proxy. The SDS agent  monitors the &lt;code class=&quot;language-text&quot;&gt;istio-system&lt;/code&gt; namespace for new secrets, and mounts them into the Gateway‚Äôs proxy on your behalf. Like the file mount method, SDS supports both server-side and mutual TLS.&lt;/p&gt;
&lt;p&gt;Let‚Äôs see how to use the SDS method to configure the Ingress Gateway with mutual HTTPS authentication.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/05f251a3f8f4b636d25e1c352003285d/0478f/arch.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100.48426150121065%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAFxGAABcRgEUlENBAAACqUlEQVQ4y5VUyVLcMBCdf+djOHPOMVXZDknBgAtmgFk9eLxK8iLLi15aljdISBFXdWlx6/Xr11Iv8M6ntX41fvT/Av/4BueiKCCEAOe8G9u2fTfYYvgxmF1PzlmWgTGGKIq6UakScRy/C7qYrwegOWCSJB1oZ3kOWSoEQYimaTCRsWd7hpp+akhpdubRhnmLo+cjJnaZiJAmHlrdvvGZCHUpX11pXFxonM8aaQpwpkkvGjkFyoH9SSIIa5SihKR0iSwEH3xAUgB5bgl1gDc3GpeXlqnJpK7tvFR0SAI/1glWXg3PT+C6LuICkMr6WF8jjYaRdTHQJnlmKdgxVcDtGfjy3ODaA5YvTWc+MUxkX8De1zDtAUGVs/RfV5j2anLcCGjHhy80lgQaUuBzapnPq2zSHgGrijQRbwC1BWR3EbCNcXQ4Pm0Bx9OICJRL/Z+AxJDR/nmbI78NcAhs2vvEmEZS9HfgY4BWnYrEdnmDY1IhKmkeZjjEFV7IV1Y26F8Y6g6Qi8nB2BA5SDKqZN3TIVpVPN7P6XXpHlAPDPXIcP5JVSPgRZ8aWa3QSgb9x30wDGfXxhCIkxa5qsBzYwqirPFwYhA0H6WgE614glYxdElNomRdADQFGB8ZEjJp9eyW2Pgp3KggjUowEmr94EOoegSkk1CrX6hOvANF7kHzPaUSvNbQPM3Hg8T1JsTTKcbnaxfR8ozcCZAwOabWmuZwu4N0ItS7rxC7byiP3wnQn2toAZ+I4f0xwPrRgbMLobYJilUIlpWTqJWEuttC3dPdSfdYOz8RH5b0VsPu3Y8MzVvcHCqs3BTOI4EeU3iRws4r4MUKVAtqW0BJuhbBCzUIBskCIrZB4e+oaTCE0azKZmK6jOki5k2b0VwjkZp93a2N2bmx9s3+1At+A+kRFELYJyYTAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;arch&quot;
        title=&quot;arch&quot;
        src=&quot;/static/05f251a3f8f4b636d25e1c352003285d/b9e4f/arch.png&quot;
        srcset=&quot;/static/05f251a3f8f4b636d25e1c352003285d/cf440/arch.png 148w,
/static/05f251a3f8f4b636d25e1c352003285d/d2d38/arch.png 295w,
/static/05f251a3f8f4b636d25e1c352003285d/b9e4f/arch.png 590w,
/static/05f251a3f8f4b636d25e1c352003285d/f9b6a/arch.png 885w,
/static/05f251a3f8f4b636d25e1c352003285d/2d849/arch.png 1180w,
/static/05f251a3f8f4b636d25e1c352003285d/0478f/arch.png 3304w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Here, a construction materials company called FooCorp runs one production Kubernetes cluster. One team, &lt;code class=&quot;language-text&quot;&gt;ux&lt;/code&gt;, runs a customer-facing web &lt;code class=&quot;language-text&quot;&gt;frontend&lt;/code&gt;. The other, &lt;code class=&quot;language-text&quot;&gt;corp-services&lt;/code&gt;, runs an internal-facing &lt;code class=&quot;language-text&quot;&gt;inventory&lt;/code&gt; for supply chain tracking. Both services have their own &lt;code class=&quot;language-text&quot;&gt;foocorp&lt;/code&gt; subdomain, and the security team has mandated that every service has its own certs and keys. Let‚Äôs walk through the configuration of secure ingress on this cluster.&lt;/p&gt;
&lt;p&gt;First, we‚Äôll install Istio, enabling the &lt;a href=&quot;https://istio.io/docs/reference/config/installation-options/#gateways-options%20option&quot;&gt;global SDS ingress&lt;/a&gt; option. When we enable this, the Istio &lt;code class=&quot;language-text&quot;&gt;ingress-gateway&lt;/code&gt; pod will have two containers, &lt;code class=&quot;language-text&quot;&gt;istio-proxy&lt;/code&gt; (Envoy) and &lt;code class=&quot;language-text&quot;&gt;ingress-sds&lt;/code&gt;, which is the Secrets Discovery agent:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;istio-ingressgateway-6f7d65d984-m2zmn     2/2     Running     0          44s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we‚Äôll create two namespaces, &lt;code class=&quot;language-text&quot;&gt;ux&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;corp-services&lt;/code&gt;, and label both for Istio sidecar proxy injection. Next, we‚Äôll apply Deployments and Services for the &lt;code class=&quot;language-text&quot;&gt;frontend&lt;/code&gt; (&lt;code class=&quot;language-text&quot;&gt;ux&lt;/code&gt; namespace) and the &lt;code class=&quot;language-text&quot;&gt;inventory&lt;/code&gt; (&lt;code class=&quot;language-text&quot;&gt;corp-services&lt;/code&gt; namespace).&lt;/p&gt;
&lt;p&gt;Now, we‚Äôre ready to generate certs and keys for two domains, &lt;code class=&quot;language-text&quot;&gt;frontend.foocorp.com&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;inventory.foocorp.com&lt;/code&gt;. (Note: you don‚Äôt need to purchase domain names to try this out - we‚Äôll test with the &lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt; header in a few steps.) We generate Kubernetes secrets from these keys:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl create -n istio-system secret generic frontend-credential  \
--from-file=key=frontend.foocorp.com/3_application/private/frontend.foocorp.com.key.pem \
--from-file=cert=frontend.foocorp.com/3_application/certs/frontend.foocorp.com.cert.pem \
--from-file=cacert=frontend.foocorp.com/2_intermediate/certs/ca-chain.cert.pem

kubectl create -n istio-system secret generic inventory-credential  \
--from-file=key=inventory.foocorp.com/3_application/private/inventory.foocorp.com.key.pem \
--from-file=cert=inventory.foocorp.com/3_application/certs/inventory.foocorp.com.cert.pem \
--from-file=cacert=inventory.foocorp.com/2_intermediate/certs/ca-chain.cert.pem&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, we‚Äôre ready to expose &lt;code class=&quot;language-text&quot;&gt;frontend&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;inventory&lt;/code&gt; with Istio resources. First, create a &lt;code class=&quot;language-text&quot;&gt;Gateway&lt;/code&gt; resource, punching port &lt;code class=&quot;language-text&quot;&gt;443&lt;/code&gt; for HTTPS traffic. Note that &lt;code class=&quot;language-text&quot;&gt;mode: MUTUAL&lt;/code&gt; indicates that we‚Äôre enforcing mutual TLS for inbound traffic. And for each service, we specify two different sets of credentials, corresponding to the Secrets we just created.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Gateway
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; foocorp&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;gateway
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;istio&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ingressgateway &lt;span class=&quot;token comment&quot;&gt;# use istio default ingress gateway&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;servers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; https&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;frontend
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HTTPS
    &lt;span class=&quot;token key atrule&quot;&gt;tls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; MUTUAL
      &lt;span class=&quot;token key atrule&quot;&gt;credentialName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;frontend-credential&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;frontend.foocorp.com&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; https&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;inventory
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HTTPS
    &lt;span class=&quot;token key atrule&quot;&gt;tls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; MUTUAL
      &lt;span class=&quot;token key atrule&quot;&gt;credentialName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;inventory-credential&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;inventory.foocorp.com&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next, create two Istio VirtualServices to handle routing from the Gateway. Since both services are mapped to port &lt;code class=&quot;language-text&quot;&gt;443&lt;/code&gt; in the Gateway, we‚Äôll use the &lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt; header (or a domain name) to specify the backend service we‚Äôre requesting.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; frontend
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;frontend.foocorp.com&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;gateways&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; foocorp&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;gateway
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;exact&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /
    &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; frontend.ux.svc.cluster.local
        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; VirtualService
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inventory
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;inventory.foocorp.com&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;gateways&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; foocorp&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;gateway
  &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;exact&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /
    &lt;span class=&quot;token key atrule&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;destination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inventory.corp&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;services.svc.cluster.local
        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Apply these YAML resources, then get the &lt;code class=&quot;language-text&quot;&gt;istio-ingressgateway&lt;/code&gt; pod logs for the &lt;code class=&quot;language-text&quot;&gt;ingress-sds&lt;/code&gt; container. You should see that when we applied a resource using specific credentials, the SDS agent mounted those certs and keys into the ingress proxy:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;istio-ingressgateway-6f7d65d984-m2zmn &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
RESOURCE NAME:inventory-credential, EVENT: pushed key/cert pair to proxy&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, we‚Äôre ready to make requests to our two services from outside the cluster. Note that because we‚Äôve configured mutual TLS, we have to specify &lt;code class=&quot;language-text&quot;&gt;cert&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt; in addition to &lt;code class=&quot;language-text&quot;&gt;ca-cert&lt;/code&gt;, in order for the server (the Ingress Gateway) to verify the identity of the client.&lt;/p&gt;
&lt;p&gt;First, from any host outside the cluster, curl the frontend, with the frontend client keys:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ curl -HHost:frontend.foocorp.com \
--resolve frontend.foocorp.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \
--cacert frontend.foocorp.com/2_intermediate/certs/ca-chain.cert.pem \
--cert frontend.foocorp.com/4_client/certs/frontend.foocorp.com.cert.pem \
--key frontend.foocorp.com/4_client/private/frontend.foocorp.com.key.pem \
https://frontend.foocorp.com:$SECURE_INGRESS_PORT/

üèó Welcome to FooCorp - Public Site&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And the internal inventory, with the inventory keys:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ curl -HHost:inventory.foocorp.com \
--resolve inventory.foocorp.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \
--cacert inventory.foocorp.com/2_intermediate/certs/ca-chain.cert.pem \
--cert inventory.foocorp.com/4_client/certs/inventory.foocorp.com.cert.pem \
--key inventory.foocorp.com/4_client/private/inventory.foocorp.com.key.pem \
https://inventory.foocorp.com:$SECURE_INGRESS_PORT/

üõ† FooCorp - Inventory [INTERNAL]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What‚Äôs actually happening here? Let‚Äôs look at the inventory service, and walk through exactly how the Ingress Gateway authenticates the client.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f2a8f6d3c0ecf6088269d7005e23defc/e7325/auth-steps.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 105.83140877598152%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAFxGAABcRgEUlENBAAADF0lEQVQ4y41Uy27bMBDM/59z60fkEhQ9FAgKBGiLpmneaVI7jiXbkvUWKYkSKXK6pCs/YrcoAYIURQ5nZ2d5BGrGGGw3+62U2lsHFBS7AMR3GJVh++wwHg2Tvu/BGEOWZVgul4jj2K3XdQ1WlvSvAitiiOwCbf6ZEDi0O2p2Ll4Ddl2HIAgwn8+xWCwceOmAmAO3o5TKzeta0KURJpOJO3eQoR2rqnKhDi3Pc8fYrrdt69hyzt1ee2kURW5uIVaj2QDazRZMa+02pmnquud5jvkAbBkO8+1Q9xg2TePoW/0siO/7SBLSTDQUekHrIWYzH+PxiFgyYiycflrbBG6iPBoSYgHdnBjWNSWAcVpTKIqKmJYYjaZ4mfjuu2kk/a/pMuD0lOHkpNwHFPbvKmmulaWmw4bC5xRySXpKWuuJHRAtK5p3CEOFd+8yHB+nxFivQnYZVh0YhWHRlFZuzPNVchgrwFm+vknRXk76aQwX9ySH2jAs+wLT9hU3xTUe2nvMuhlqVKgIv5XAYyhx/tLjcg78WABnTwK3c4mookRKIiCtO/QGMFIRPrD3+FSf4UZc47q5wox7SCOBpGgwJ3leUoGolEhIZka2IwnBW4qCVJKddix3GHrdFKkim6gEWZ9hnvlIYwFOB5IyIUN+hH72UUUtLgJgmhksuXHgFpCxLcDBkNpoW0QQXYuHh3sEi9IxyfJvJNRXyLsI4VOBcx8YJwZpbVC2pKkD1LtZ3n0Y4HyWZ5IYGszSAOQBsKQl+1TwSIKAGSdFsQY8wND1rUK3tulI8JCS8+yluJ+EePZjxFwirgySyjrCoGv/wnAbeLCNndY8x+PDHcK5Ry+ND9OQhXqiJ1LKTgjB6AHhZv3qHL2txWEsip4Mv3qFoiiG6lv0foj2Z4E+G9OGERBfQRQpAWIf8C2wBRxqdNVIybspmtsM+vUS08cvyEfnkCw7zPAQoNZm57XWUQDl0UstcxTBL4joEbLK/x/QVoCtUSH+9KZGKyrSjRMQ9ZqjJHdz/k/bDDVrXPbs5k03q05lZ1lZ7Thlu+83+v8G5mVZN5IjiuMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;auth steps&quot;
        title=&quot;auth steps&quot;
        src=&quot;/static/f2a8f6d3c0ecf6088269d7005e23defc/b9e4f/auth-steps.png&quot;
        srcset=&quot;/static/f2a8f6d3c0ecf6088269d7005e23defc/cf440/auth-steps.png 148w,
/static/f2a8f6d3c0ecf6088269d7005e23defc/d2d38/auth-steps.png 295w,
/static/f2a8f6d3c0ecf6088269d7005e23defc/b9e4f/auth-steps.png 590w,
/static/f2a8f6d3c0ecf6088269d7005e23defc/f9b6a/auth-steps.png 885w,
/static/f2a8f6d3c0ecf6088269d7005e23defc/2d849/auth-steps.png 1180w,
/static/f2a8f6d3c0ecf6088269d7005e23defc/e7325/auth-steps.png 3464w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Client requests the host &lt;code class=&quot;language-text&quot;&gt;https://inventory.foocorp.com:443&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;DNS for &lt;code class=&quot;language-text&quot;&gt;inventory.foocorp.com&lt;/code&gt; resolves to the Istio Ingress Gateway‚Äôs public IP, provisioned by default with a Kubernetes Service &lt;code class=&quot;language-text&quot;&gt;type=LoadBalancer&lt;/code&gt;. The Ingress Gateway presents its cert and key to the client.&lt;/li&gt;
&lt;li&gt;Client verifies the Ingress Gateway‚Äôs identity with the Certificate Authority (CA).&lt;/li&gt;
&lt;li&gt;Client presents its cert and key to the Ingress Gateway.&lt;/li&gt;
&lt;li&gt;Server (Ingress Gateway) verifies client‚Äôs identity with the CA.&lt;/li&gt;
&lt;li&gt;A secure connection is established between the client and the Ingress Gateway, and the Ingress Gateway forwards requests to the &lt;code class=&quot;language-text&quot;&gt;inventory&lt;/code&gt; Service.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;üéä We did it! From here, you can keep adding new services, and scale out the Ingress Gateway replicas to support a secure, centrally-managed ingress for your cluster.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Learn More:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/concepts/traffic-management/#gateways&quot;&gt;Istio Ingress Gateway - Concepts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/tasks/traffic-management/ingress/secure-ingress-sds/#configure-a-tls-ingress-gateway-for-multiple-hosts&quot;&gt;Istio SDS Ingress, server-side TLS only&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/tasks/traffic-management/ingress/secure-ingress-mount/#before-you-begin&quot;&gt;Istio SDS Ingress, manual file-mount approach&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[mutual tls]]></title><description><![CDATA[A microservices architecture means more requests on the network, and more opportunities for malicious parties to intercept traffic. Mutual‚Ä¶]]></description><link>https://istiobyexample.dev//mtls/</link><guid isPermaLink="false">https://istiobyexample.dev//mtls/</guid><pubDate>Fri, 01 May 2015 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;A microservices architecture means more requests on the network, and more opportunities for malicious parties to intercept traffic. &lt;a href=&quot;https://en.wikipedia.org/wiki/Mutual_authentication&quot;&gt;Mutual TLS&lt;/a&gt; (mTLS) authentication is a way to encrypt services traffic using &lt;a href=&quot;https://www.internetsociety.org/deploy360/tls/basics/&quot;&gt;certificates&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;With Istio, you can automate the enforcement of mTLS across all services. Below, we enable mTLS for the entire mesh. Two pods in the cluster, &lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;, are shown establishing a secure connection with the mTLS policy in place.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4023fdf6c75d10290a6dd65f63b7471e/3e8e9/mtls.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.11169170476813%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAJnKAACZygHjkaQiAAABQElEQVQoz4WRXU/jMBBF8/9/Eu+LQLuiBR7QlhIKTQtNGyf+jB0nPrjhCQnBSFdjWbrHcz0Fv1T65jxNE0MYGYaRGM+aZqWUKJwbaBpL1/WfXUW6g6EVnt42meJIYUfqV+DumcI7rYxI7bMG2i5kr+N4NDOjEMKx3bZUVUf5LPCyxv6tUKsKKR7B/iOZG5K9B3NN1Eu6astYdvkhzamuOTU9+51kl1W0rWO9PrFaHXnN0EksCIsd/cMC061BX5H0NcmX0D8ymUvU8oLhSRDKOzZPS8pSsdk081AzcL+XSNlT1xo/QDharErIepkhdxlW5eT/58gxNIh3g1vnNC7RtB6tPIeD5u1NUYzjhDEBlS+1zl06pPEoHYnyT458O8OSfyFFMS/F5n+X9uzps8fP3vNA3keKX7ec4pctnzf5U30ADZwaIEs3XGIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Diagram&quot;
        title=&quot;Diagram&quot;
        src=&quot;/static/4023fdf6c75d10290a6dd65f63b7471e/b9e4f/mtls.png&quot;
        srcset=&quot;/static/4023fdf6c75d10290a6dd65f63b7471e/cf440/mtls.png 148w,
/static/4023fdf6c75d10290a6dd65f63b7471e/d2d38/mtls.png 295w,
/static/4023fdf6c75d10290a6dd65f63b7471e/b9e4f/mtls.png 590w,
/static/4023fdf6c75d10290a6dd65f63b7471e/f9b6a/mtls.png 885w,
/static/4023fdf6c75d10290a6dd65f63b7471e/2d849/mtls.png 1180w,
/static/4023fdf6c75d10290a6dd65f63b7471e/3e8e9/mtls.png 6124w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; authentication.istio.io/v1alpha1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; MeshPolicy
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;peers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;mtls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; STRICT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.istio.io/v1alpha3
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DestinationRule
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; istio&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;system
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*.local&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;tls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ISTIO_MUTUAL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here, a &lt;code class=&quot;language-text&quot;&gt;MeshPolicy&lt;/code&gt; enforces TLS for all services &lt;em&gt;receiving&lt;/em&gt; requests (server-side), and a &lt;code class=&quot;language-text&quot;&gt;DestinationRule&lt;/code&gt; enforces TLS for all services &lt;em&gt;sending&lt;/em&gt; requests (client-side), resulting in mutual (‚Äúboth‚Äù) TLS.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Authentication Flow:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt; application container sends a plain-text HTTP request to &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt; proxy container intercepts the outbound request.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt; proxy performs a TLS &lt;a href=&quot;https://www.ibm.com/support/knowledgecenter/en/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660_.htm&quot;&gt;handshake&lt;/a&gt; with the server-side proxy. This handshake includes an exchange of certificates. These certs are pre-loaded into the proxy containers by Istio.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt; proxy performs a &lt;a href=&quot;https://istio.io/docs/concepts/security/#secure-naming&quot;&gt;secure naming&lt;/a&gt; check on the server‚Äôs certificate, verifying that an authorized identity is running the &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt; establish a mutual TLS connection, and the &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt; proxy forwards the request to the &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt; application container.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Learn more&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/concepts/security/#authentication&quot;&gt;Istio Docs - Authentication&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/GoogleCloudPlatform/istio-samples/tree/77fb1dfb690d28517e410df2911e255d54e3450e/security-intro#authentication&quot;&gt;Samples: Authentication&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/tasks/security/authn-policy/&quot;&gt;Task - Authentication Policies&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/docs/tasks/security/mutual-tls/&quot;&gt;Task - Mutual TLS Deep-Dive&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://istio.io/faq/security/#enabling-disabling-mtls&quot;&gt;FAQ - mTLS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item></channel></rss>